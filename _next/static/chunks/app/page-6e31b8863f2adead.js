(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{6654:function(e,t,s){Promise.resolve().then(s.bind(s,8268))},8268:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return tT}});var n=s(7437),r=s(2265),a=s(2660),i=s(4438),d=s(1905),l=s(3374),o=s(1994),c=s(3335);function m(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(0,c.m6)((0,o.W)(t))}function u(e){let{className:t,...s}=e;return(0,n.jsx)(l.eh,{"data-slot":"resizable-panel-group",className:m("flex h-full w-full data-[panel-group-direction=vertical]:flex-col",t),...s})}function x(e){let{...t}=e;return(0,n.jsx)(l.s_,{"data-slot":"resizable-panel",...t})}function p(e){let{withHandle:t,className:s,...r}=e;return(0,n.jsx)(l.OT,{"data-slot":"resizable-handle",className:m("bg-border focus-visible:ring-ring relative flex w-px items-center justify-center after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:ring-1 focus-visible:ring-offset-1 focus-visible:outline-hidden data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:translate-x-0 data-[panel-group-direction=vertical]:after:-translate-y-1/2 [&[data-panel-group-direction=vertical]>div]:rotate-90",s),...r,children:t&&(0,n.jsx)("div",{className:"bg-border z-10 flex h-4 w-3 items-center justify-center rounded-xs border",children:(0,n.jsx)(d.Z,{className:"size-2.5"})})})}var h=s(7495),g=s(535);let f=(0,g.j)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-white hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9","icon-sm":"size-8","icon-lg":"size-10"}},defaultVariants:{variant:"default",size:"default"}});function v(e){let{className:t,variant:s,size:r,asChild:a=!1,...i}=e,d=a?h.g7:"button";return(0,n.jsx)(d,{"data-slot":"button",className:m(f({variant:s,size:r,className:t})),...i})}function b(e){let{className:t,type:s,...r}=e;return(0,n.jsx)("input",{type:s,"data-slot":"input",className:m("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",t),...r})}var j=s(3643);function N(e){let{className:t,children:s,...r}=e;return(0,n.jsxs)(j.fC,{"data-slot":"scroll-area",className:m("relative",t),...r,children:[(0,n.jsx)(j.l_,{"data-slot":"scroll-area-viewport",className:"focus-visible:ring-ring/50 size-full rounded-[inherit] transition-[color,box-shadow] outline-none focus-visible:ring-[3px] focus-visible:outline-1",children:s}),(0,n.jsx)(y,{}),(0,n.jsx)(j.Ns,{})]})}function y(e){let{className:t,orientation:s="vertical",...r}=e;return(0,n.jsx)(j.gb,{"data-slot":"scroll-area-scrollbar",orientation:s,className:m("flex touch-none p-px transition-colors select-none","vertical"===s&&"h-full w-2.5 border-l border-l-transparent","horizontal"===s&&"h-2.5 flex-col border-t border-t-transparent",t),...r,children:(0,n.jsx)(j.q4,{"data-slot":"scroll-area-thumb",className:"bg-border relative flex-1 rounded-full"})})}var _=s(962);function w(e){let{...t}=e;return(0,n.jsx)(_.fC,{"data-slot":"collapsible",...t})}function A(e){let{...t}=e;return(0,n.jsx)(_.wy,{"data-slot":"collapsible-trigger",...t})}function k(e){let{...t}=e;return(0,n.jsx)(_.Fw,{"data-slot":"collapsible-content",...t})}var T=s(1668);function C(e){let{delayDuration:t=0,...s}=e;return(0,n.jsx)(T.zt,{"data-slot":"tooltip-provider",delayDuration:t,...s})}function E(e){let{...t}=e;return(0,n.jsx)(C,{children:(0,n.jsx)(T.fC,{"data-slot":"tooltip",...t})})}function S(e){let{...t}=e;return(0,n.jsx)(T.xz,{"data-slot":"tooltip-trigger",...t})}function I(e){let{className:t,sideOffset:s=0,children:r,...a}=e;return(0,n.jsx)(T.h_,{children:(0,n.jsxs)(T.VY,{"data-slot":"tooltip-content",sideOffset:s,className:m("bg-foreground text-background animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 w-fit origin-(--radix-tooltip-content-transform-origin) rounded-md px-3 py-1.5 text-xs text-balance",t),...a,children:[r,(0,n.jsx)(T.Eh,{className:"bg-foreground fill-foreground z-50 size-2.5 translate-y-[calc(-50%_-_2px)] rotate-45 rounded-[2px]"})]})})}var D=s(4952),O=s(4935),M=s(3927),L=s(8728),R=s(8736),z=s(740),Z=s(7168),V=s(3247),H=s(875),P=s(407),B=s(4924),U=s(91),W=s(5330);D.Z,O.Z,M.Z,L.Z,R.Z;let F={plan:"text-green-500",task:"text-blue-500",table:"text-blue-500",config:"text-orange-500",report:"text-purple-500"};function q(e){let{artifacts:t,selectedArtifactId:s,onSelectArtifact:a,filterType:i,onFilterChange:d,currentSession:l}=e,[o,c]=(0,r.useState)(""),[u,x]=(0,r.useState)({plan:!0,task:!0,table:!0,config:!0,report:!0}),{taskFolders:p,otherGroups:h,relatedConfigs:g}=(0,r.useMemo)(()=>{let e=t.filter(e=>""===o||e.name.toLowerCase().includes(o.toLowerCase())),s=[],n={plan:[],table:[],report:[]},r=new Map,a=new Map;return e.forEach(e=>{"task"===e.type&&e.groupId&&a.set(e.groupId,e)}),e.forEach(e=>{e.groupId&&a.has(e.groupId)&&"config"===e.type&&r.set(e.groupId,e)}),e.forEach(e=>{if(!("config"===e.type&&e.groupId&&a.has(e.groupId))){if("task"===e.type){let t=e.name.includes("dts")||e.name.includes("hive2ck"),n=e.name.replace(".sql","").replace(/^dts_hive2ck_/,""),a=e.groupId?r.get(e.groupId):void 0;s.push({taskName:n,taskArtifact:e,configArtifact:a,isDTS:t})}else"plan"===e.type?n.plan.push(e):"table"===e.type?n.table.push(e):"report"===e.type?n.report.push(e):e.type}}),{taskFolders:s,otherGroups:n,relatedConfigs:r}},[t,o,i]),f=e=>{x(t=>({...t,[e]:!t[e]}))};return(0,r.useMemo)(()=>t.filter(e=>{let t=""===o||e.name.toLowerCase().includes(o.toLowerCase()),s="all"===i||e.type===i;return t&&s}),[t,o,i]),(0,n.jsxs)("div",{className:"flex h-full flex-col border-r border-border bg-sidebar",children:[(0,n.jsx)("div",{className:"border-b border-border bg-ide-panel-header px-3 py-2",children:(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsx)("span",{className:"text-sm font-medium text-foreground",children:"产物列表"}),(0,n.jsxs)("div",{className:"flex items-center gap-1",children:[(0,n.jsx)(C,{children:(0,n.jsxs)(E,{children:[(0,n.jsx)(S,{asChild:!0,children:(0,n.jsx)(v,{variant:"ghost",size:"icon",className:"h-6 w-6 text-muted-foreground hover:bg-ide-hover hover:text-foreground",children:(0,n.jsx)(z.Z,{className:"h-3.5 w-3.5"})})}),(0,n.jsx)(I,{children:"筛选"})]})}),(0,n.jsx)(C,{children:(0,n.jsxs)(E,{children:[(0,n.jsx)(S,{asChild:!0,children:(0,n.jsx)(v,{variant:"ghost",size:"icon",className:"h-6 w-6 text-muted-foreground hover:bg-ide-hover hover:text-foreground",children:(0,n.jsx)(Z.Z,{className:"h-3.5 w-3.5"})})}),(0,n.jsx)(I,{children:"刷新"})]})})]})]})}),(0,n.jsx)("div",{className:"border-b border-border bg-sidebar p-2",children:(0,n.jsxs)("div",{className:"relative",children:[(0,n.jsx)(V.Z,{className:"absolute left-2 top-1/2 h-3.5 w-3.5 -translate-y-1/2 text-muted-foreground"}),(0,n.jsx)(b,{placeholder:"搜索产物...",value:o,onChange:e=>c(e.target.value),className:"h-7 border-border bg-input pl-7 text-xs text-foreground placeholder:text-muted-foreground focus:ring-primary"})]})}),(0,n.jsx)(C,{delayDuration:300,children:(0,n.jsx)(N,{className:"flex-1",children:(0,n.jsxs)("div",{className:"p-2 space-y-1",children:[h.plan.length>0&&(0,n.jsx)("div",{children:(0,n.jsxs)(w,{open:u.plan,onOpenChange:()=>f("plan"),children:[(0,n.jsx)(A,{asChild:!0,children:(0,n.jsxs)("button",{type:"button",className:"flex w-full items-center gap-2 rounded-md px-2 py-1.5 text-left text-xs hover:bg-ide-hover transition-colors",children:[u.plan?(0,n.jsx)(H.Z,{className:"h-4 w-4 shrink-0 text-muted-foreground"}):(0,n.jsx)(P.Z,{className:"h-4 w-4 shrink-0 text-muted-foreground"}),(0,n.jsx)(B.Z,{className:"h-4 w-4 shrink-0 text-muted-foreground/50 fill-muted-foreground/20"}),(0,n.jsx)("span",{className:"font-medium text-foreground",children:"开发计划"}),(0,n.jsx)("span",{className:"ml-auto text-[10px] text-muted-foreground",children:h.plan.length})]})}),(0,n.jsx)(k,{className:"relative ml-2 border-l border-border pl-1",children:h.plan.map(e=>{let t=e.id===s,r=(e.versions.find(t=>t.version===e.currentVersion)||e.versions[0]).status;return(0,n.jsxs)("button",{type:"button",onClick:()=>a(e.id),className:m("group flex w-full items-center gap-2 rounded-sm px-2 py-1 text-left text-[13px] transition-colors",t?"bg-ide-selection text-foreground font-medium":"text-muted-foreground hover:bg-ide-hover hover:text-foreground"),children:[(0,n.jsx)(R.Z,{className:m("h-4 w-4 shrink-0",F.plan)}),(0,n.jsx)("span",{className:"flex-1 truncate leading-none",children:e.name}),"pending_review"===r&&(0,n.jsx)("div",{className:"h-2 w-2 rounded-full bg-amber-400 ring-2 ring-amber-400/20"}),"approved"===r&&(0,n.jsx)("div",{className:"h-1.5 w-1.5 rounded-full bg-green-500/50"})]},e.id)})})]})}),p.length>0&&(0,n.jsx)(n.Fragment,{children:p.map(e=>{let t="task-folder-".concat(e.taskArtifact.id),r=!1!==u[t],i=e.isDTS?"DTS任务-".concat(e.taskName):"任务-".concat(e.taskName),d=e.taskArtifact.versions.find(t=>t.version===e.taskArtifact.currentVersion)||e.taskArtifact.versions[0],l=d.status,o=d.changes;return(0,n.jsx)("div",{children:(0,n.jsxs)(w,{open:r,onOpenChange:()=>x(e=>({...e,[t]:!r})),children:[(0,n.jsx)(A,{asChild:!0,children:(0,n.jsxs)("button",{type:"button",className:"flex w-full items-center gap-2 rounded-md px-2 py-1.5 text-left text-xs hover:bg-ide-hover transition-colors",children:[r?(0,n.jsx)(H.Z,{className:"h-4 w-4 shrink-0 text-muted-foreground"}):(0,n.jsx)(P.Z,{className:"h-4 w-4 shrink-0 text-muted-foreground"}),(0,n.jsx)(B.Z,{className:"h-4 w-4 shrink-0 text-amber-500/70 fill-amber-500/20"}),(0,n.jsx)("span",{className:"font-medium text-foreground truncate flex-1",children:i}),"pending_review"===l&&(0,n.jsx)("div",{className:"h-2 w-2 rounded-full bg-amber-400 ring-2 ring-amber-400/20"})]})}),(0,n.jsxs)(k,{className:"relative ml-2 border-l border-border pl-1",children:[(0,n.jsxs)("button",{type:"button",onClick:()=>a(e.taskArtifact.id),className:m("group flex w-full items-center gap-2 rounded-sm px-2 py-1 text-left text-[12px] transition-colors",e.taskArtifact.id===s?"bg-ide-selection text-foreground font-medium":"text-muted-foreground hover:bg-ide-hover hover:text-foreground"),children:[e.isDTS?(0,n.jsx)(U.Z,{className:m("h-3.5 w-3.5 shrink-0",F.task)}):(0,n.jsx)(W.Z,{className:m("h-3.5 w-3.5 shrink-0",F.task)}),(0,n.jsx)("span",{className:"flex-1 truncate leading-none",children:e.taskArtifact.name}),o&&(0,n.jsxs)("span",{className:"text-[10px] font-mono",children:[(0,n.jsxs)("span",{className:"text-green-500",children:["+",o.added]})," ",(0,n.jsxs)("span",{className:"text-red-500",children:["-",o.removed]})]})]}),e.configArtifact&&(0,n.jsxs)("button",{type:"button",onClick:()=>a(e.configArtifact.id),className:m("group flex w-full items-center gap-2 rounded-sm px-2 py-1 text-left text-[12px] transition-colors",e.configArtifact.id===s?"bg-ide-selection text-foreground font-medium":"text-muted-foreground hover:bg-ide-hover hover:text-foreground"),children:[(0,n.jsx)(L.Z,{className:m("h-3.5 w-3.5 shrink-0",F.config)}),(0,n.jsx)("span",{className:"flex-1 truncate leading-none",children:e.configArtifact.name})]})]})]})},t)})}),h.table.length>0&&(0,n.jsx)("div",{children:(0,n.jsxs)(w,{open:u.table,onOpenChange:()=>f("table"),children:[(0,n.jsx)(A,{asChild:!0,children:(0,n.jsxs)("button",{type:"button",className:"flex w-full items-center gap-2 rounded-md px-2 py-1.5 text-left text-xs hover:bg-ide-hover transition-colors",children:[u.table?(0,n.jsx)(H.Z,{className:"h-4 w-4 shrink-0 text-muted-foreground"}):(0,n.jsx)(P.Z,{className:"h-4 w-4 shrink-0 text-muted-foreground"}),(0,n.jsx)(B.Z,{className:"h-4 w-4 shrink-0 text-muted-foreground/50 fill-muted-foreground/20"}),(0,n.jsx)("span",{className:"font-medium text-foreground",children:"表"}),(0,n.jsx)("span",{className:"ml-auto text-[10px] text-muted-foreground",children:h.table.length})]})}),(0,n.jsx)(k,{className:"relative ml-2 border-l border-border pl-1",children:h.table.map(e=>{let t=e.id===s,r=(e.versions.find(t=>t.version===e.currentVersion)||e.versions[0]).status;return(0,n.jsxs)("button",{type:"button",onClick:()=>a(e.id),className:m("group flex w-full items-center gap-2 rounded-sm px-2 py-1 text-left text-[13px] transition-colors",t?"bg-ide-selection text-foreground font-medium":"text-muted-foreground hover:bg-ide-hover hover:text-foreground"),children:[(0,n.jsx)(U.Z,{className:m("h-4 w-4 shrink-0",F.table)}),(0,n.jsx)("span",{className:"flex-1 truncate leading-none",children:e.name}),"pending_review"===r&&(0,n.jsx)("div",{className:"h-2 w-2 rounded-full bg-amber-400 ring-2 ring-amber-400/20"}),"approved"===r&&(0,n.jsx)("div",{className:"h-1.5 w-1.5 rounded-full bg-green-500/50"})]},e.id)})})]})}),h.report.length>0&&(0,n.jsx)("div",{children:(0,n.jsxs)(w,{open:u.report,onOpenChange:()=>f("report"),children:[(0,n.jsx)(A,{asChild:!0,children:(0,n.jsxs)("button",{type:"button",className:"flex w-full items-center gap-2 rounded-md px-2 py-1.5 text-left text-xs hover:bg-ide-hover transition-colors",children:[u.report?(0,n.jsx)(H.Z,{className:"h-4 w-4 shrink-0 text-muted-foreground"}):(0,n.jsx)(P.Z,{className:"h-4 w-4 shrink-0 text-muted-foreground"}),(0,n.jsx)(B.Z,{className:"h-4 w-4 shrink-0 text-muted-foreground/50 fill-muted-foreground/20"}),(0,n.jsx)("span",{className:"font-medium text-foreground",children:"报告"}),(0,n.jsx)("span",{className:"ml-auto text-[10px] text-muted-foreground",children:h.report.length})]})}),(0,n.jsx)(k,{className:"relative ml-2 border-l border-border pl-1",children:h.report.map(e=>{let t=e.id===s,r=(e.versions.find(t=>t.version===e.currentVersion)||e.versions[0]).status;return(0,n.jsxs)("button",{type:"button",onClick:()=>a(e.id),className:m("group flex w-full items-center gap-2 rounded-sm px-2 py-1 text-left text-[13px] transition-colors",t?"bg-ide-selection text-foreground font-medium":"text-muted-foreground hover:bg-ide-hover hover:text-foreground"),children:[(0,n.jsx)(R.Z,{className:m("h-4 w-4 shrink-0",F.report)}),(0,n.jsx)("span",{className:"flex-1 truncate leading-none",children:e.name}),"pending_review"===r&&(0,n.jsx)("div",{className:"h-2 w-2 rounded-full bg-amber-400 ring-2 ring-amber-400/20"})]},e.id)})})]})}),0===h.plan.length&&0===h.table.length&&0===h.report.length&&0===p.length&&(0,n.jsx)("div",{className:"py-8 text-center text-xs text-muted-foreground",children:0===t.length?"当前会话暂无产物":"未找到匹配的产物"})]})})}),(0,n.jsxs)("div",{className:"border-t border-border px-3 py-2 text-xs text-muted-foreground",children:["共 ",t.length," 个产物"]})]})}var G=s(271);function Y(e){let{className:t,...s}=e;return(0,n.jsx)(G.fC,{"data-slot":"tabs",className:m("flex flex-col gap-2",t),...s})}function $(e){let{className:t,...s}=e;return(0,n.jsx)(G.aV,{"data-slot":"tabs-list",className:m("bg-muted text-muted-foreground inline-flex h-9 w-fit items-center justify-center rounded-lg p-[3px]",t),...s})}function Q(e){let{className:t,...s}=e;return(0,n.jsx)(G.xz,{"data-slot":"tabs-trigger",className:m("data-[state=active]:bg-background dark:data-[state=active]:text-foreground focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:outline-ring dark:data-[state=active]:border-input dark:data-[state=active]:bg-input/30 text-foreground dark:text-muted-foreground inline-flex h-[calc(100%-1px)] flex-1 items-center justify-center gap-1.5 rounded-md border border-transparent px-2 py-1 text-sm font-medium whitespace-nowrap transition-[color,box-shadow] focus-visible:ring-[3px] focus-visible:outline-1 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:shadow-sm [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",t),...s})}var X=s(4797),K=s(401),J=s(2135);function ee(e){let{...t}=e;return(0,n.jsx)(X.fC,{"data-slot":"select",...t})}function et(e){let{...t}=e;return(0,n.jsx)(X.B4,{"data-slot":"select-value",...t})}function es(e){let{className:t,size:s="default",children:r,...a}=e;return(0,n.jsxs)(X.xz,{"data-slot":"select-trigger","data-size":s,className:m("border-input data-[placeholder]:text-muted-foreground [&_svg:not([class*='text-'])]:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 dark:hover:bg-input/50 flex w-fit items-center justify-between gap-2 rounded-md border bg-transparent px-3 py-2 text-sm whitespace-nowrap shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 data-[size=default]:h-9 data-[size=sm]:h-8 *:data-[slot=select-value]:line-clamp-1 *:data-[slot=select-value]:flex *:data-[slot=select-value]:items-center *:data-[slot=select-value]:gap-2 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",t),...a,children:[r,(0,n.jsx)(X.JO,{asChild:!0,children:(0,n.jsx)(H.Z,{className:"size-4 opacity-50"})})]})}function en(e){let{className:t,children:s,position:r="popper",...a}=e;return(0,n.jsx)(X.h_,{children:(0,n.jsxs)(X.VY,{"data-slot":"select-content",className:m("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 relative z-50 max-h-(--radix-select-content-available-height) min-w-[8rem] origin-(--radix-select-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border shadow-md","popper"===r&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",t),position:r,...a,children:[(0,n.jsx)(ea,{}),(0,n.jsx)(X.l_,{className:m("p-1","popper"===r&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)] scroll-my-1"),children:s}),(0,n.jsx)(ei,{})]})})}function er(e){let{className:t,children:s,...r}=e;return(0,n.jsxs)(X.ck,{"data-slot":"select-item",className:m("focus:bg-accent focus:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground relative flex w-full cursor-default items-center gap-2 rounded-sm py-1.5 pr-8 pl-2 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4 *:[span]:last:flex *:[span]:last:items-center *:[span]:last:gap-2",t),...r,children:[(0,n.jsx)("span",{className:"absolute right-2 flex size-3.5 items-center justify-center",children:(0,n.jsx)(X.wU,{children:(0,n.jsx)(K.Z,{className:"size-4"})})}),(0,n.jsx)(X.eT,{children:s})]})}function ea(e){let{className:t,...s}=e;return(0,n.jsx)(X.u_,{"data-slot":"select-scroll-up-button",className:m("flex cursor-default items-center justify-center py-1",t),...s,children:(0,n.jsx)(J.Z,{className:"size-4"})})}function ei(e){let{className:t,...s}=e;return(0,n.jsx)(X.$G,{"data-slot":"select-scroll-down-button",className:m("flex cursor-default items-center justify-center py-1",t),...s,children:(0,n.jsx)(H.Z,{className:"size-4"})})}let ed=(0,g.j)("inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground"}},defaultVariants:{variant:"default"}});function el(e){let{className:t,variant:s,asChild:r=!1,...a}=e,i=r?h.g7:"span";return(0,n.jsx)(i,{"data-slot":"badge",className:m(ed({variant:s}),t),...a})}function eo(e){let{className:t,...s}=e;return(0,n.jsx)("textarea",{"data-slot":"textarea",className:m("border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-transparent px-3 py-2 text-base shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),...s})}var ec=s(1),em=s(2489);function eu(e){let{...t}=e;return(0,n.jsx)(ec.fC,{"data-slot":"dialog",...t})}function ex(e){let{...t}=e;return(0,n.jsx)(ec.h_,{"data-slot":"dialog-portal",...t})}function ep(e){let{className:t,...s}=e;return(0,n.jsx)(ec.aV,{"data-slot":"dialog-overlay",className:m("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",t),...s})}function eh(e){let{className:t,children:s,showCloseButton:r=!0,...a}=e;return(0,n.jsxs)(ex,{"data-slot":"dialog-portal",children:[(0,n.jsx)(ep,{}),(0,n.jsxs)(ec.VY,{"data-slot":"dialog-content",className:m("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",t),...a,children:[s,r&&(0,n.jsxs)(ec.x8,{"data-slot":"dialog-close",className:"ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",children:[(0,n.jsx)(em.Z,{}),(0,n.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})}function eg(e){let{className:t,...s}=e;return(0,n.jsx)("div",{"data-slot":"dialog-header",className:m("flex flex-col gap-2 text-center sm:text-left",t),...s})}function ef(e){let{className:t,...s}=e;return(0,n.jsx)("div",{"data-slot":"dialog-footer",className:m("flex flex-col-reverse gap-2 sm:flex-row sm:justify-end",t),...s})}function ev(e){let{className:t,...s}=e;return(0,n.jsx)(ec.Dx,{"data-slot":"dialog-title",className:m("text-lg leading-none font-semibold",t),...s})}function eb(e){let{className:t,...s}=e;return(0,n.jsx)(ec.dk,{"data-slot":"dialog-description",className:m("text-muted-foreground text-sm",t),...s})}var ej=s(1723),eN=s(9322),ey=s(5621),e_=s(6362),ew=s(2208),eA=s(2207),ek=s(6272),eT=s(3781),eC=s(9076),eE=s(2023);let eS={plan:{label:"开发计划",icon:"file-text",riskLevel:"low",rollbackCapability:"full",rollbackDescription:"计划文档，支持随时修改",targetPlatform:"Dorado 数据开发",urlTemplate:"https://dorado.dev/plan/{{id}}"},task:{label:"离线任务",icon:"code",riskLevel:"low",rollbackCapability:"full",rollbackDescription:"支持完全回滚到任意历史版本",targetPlatform:"Dorado 数据开发",urlTemplate:"https://dorado.dev/studio/task/{{id}}"},table:{label:"数据表",icon:"table",riskLevel:"medium",rollbackCapability:"limited",rollbackDescription:"仅支持 DDL 回滚，数据变更不可恢复",targetPlatform:"Coral 数据地图",urlTemplate:"https://coral.map/table/{{id}}"},config:{label:"调度配置",icon:"settings",riskLevel:"high",rollbackCapability:"none",rollbackDescription:"涉及调度策略变更，不支持回滚",targetPlatform:"Dorado 治理平台",urlTemplate:"https://dorado.gov/config/{{id}}"},report:{label:"测试报告",icon:"file-text",riskLevel:"low",rollbackCapability:"full",rollbackDescription:"支持完全回滚",targetPlatform:"Dorado 治理平台",urlTemplate:"https://dorado.gov/report/{{id}}"}},eI=[{id:"session-plan-1",title:"实时礼物榜单开发",createdAt:"2025-12-08 09:00:00",updatedAt:"2025-12-08 10:30:00",changeType:"create",scenario:"Plan模式 - 计划驱动开发",phase:"dev_review",planArtifactId:"artifact-plan-1",messages:[{id:"msg-plan-1",role:"user",content:"我需要开发一个实时礼物榜单功能，帮我先做个开发计划。",timestamp:"2025-12-08 09:00:00"},{id:"msg-plan-2",role:"assistant",content:"好的，我已为您生成「实时礼物榜单开发计划」。\n\n计划包含以下内容：\n- 需求分析与业务背景\n- 技术方案与数据流设计\n- 产物清单（4个产物）\n- 时间计划与风险评估\n\n请查看左侧的开发计划文档，确认无误后可以进行修改，或直接告诉我「基于这个开发」开始生成产物。",timestamp:"2025-12-08 09:05:00",relatedArtifacts:["artifact-plan-1"]},{id:"msg-plan-3",role:"user",content:"计划看起来不错，基于这个开发",timestamp:"2025-12-08 09:30:00"},{id:"msg-plan-4",role:"assistant",content:"好的，我正在基于开发计划生成具体产物...\n\n已生成以下产物：\n\n1. **gift_ranking_init_df** - 历史数据初始化任务\n2. **dwd_gift_ranking_df** - 礼物榜单明细表\n3. **gift_ranking_test_report** - 自动化测试报告\n\nDTS配置也已生成。请审核这些产物，确认后即可部署。",timestamp:"2025-12-08 10:00:00",relatedArtifacts:["artifact-plan-1","artifact-pg-1","artifact-pg-2","artifact-pg-6"]}],artifactIds:["artifact-plan-1","artifact-pg-1","artifact-pg-2","artifact-pg-3","artifact-pg-4","artifact-pg-5","artifact-pg-6"]},{id:"session-dogfooding-1",title:"创建广告交易数据测试",createdAt:"2025-11-06 11:40:50",updatedAt:"2025-11-06 14:30:22",changeType:"create",scenario:"V1.0_Dogfooding_case - 新增产物",phase:"dev_review",messages:[{id:"msg-df-1",role:"user",content:"首先，我需要创建一个测试实例，然后进行数据测试。",timestamp:"2025-11-06 11:40:50"},{id:"msg-df-2",role:"assistant",content:"好的，我将为您创建测试实例。我已为您生成以下产物：\n\n1. **ads_live_transaction_summary_df** - 交易汇总任务\n2. **dwd_gift_detail_df** - 礼物明细表\n3. **测试报告** - 自动化测试报告\n\n请审核这些产物，确认后即可部署。",timestamp:"2025-11-06 11:41:15",relatedArtifacts:["artifact-1","artifact-2","artifact-3"]}],artifactIds:["artifact-1","artifact-2","artifact-3"]},{id:"session-shenyulin-1",title:"优化指标和表结构",createdAt:"2025-12-07 10:00:00",updatedAt:"2025-12-07 11:00:00",changeType:"modify",scenario:"shenyulin_test - 修改产物",phase:"dev_review",messages:[{id:"msg-sy-1",role:"user",content:"帮我优化用户活跃度指标的计算逻辑，并添加WAU指标。另外，dwd_gift_detail_df 表需要新增几个字段。",timestamp:"2025-12-07 10:00:00"},{id:"msg-sy-2",role:"assistant",content:"我已完成以下优化：\n\n**1. 用户活跃度指标优化**\n- 新增 WAU（周活跃用户）指标\n- 新增 daily_active_rate 活跃度趋势\n- 优化查询性能，添加排序\n\n**2. 表结构智能建改**\n- 新增 receiver_user_id、gift_type、gift_category 等字段\n- 添加 is_combo 和 combo_count 连击相关字段\n- 建议添加二级索引优化查询\n\n**3. DTS同步配置优化**\n- 从全量同步改为增量同步\n- 增大批次和并发度\n- 添加监控告警配置\n\n请查看变更差异并审核。",timestamp:"2025-12-07 10:30:00",relatedArtifacts:["artifact-4","artifact-5","artifact-6"]}],artifactIds:["artifact-4","artifact-5","artifact-6"]},{id:"session-edit-1",title:"编辑任务 dm_user_order_stats_df",createdAt:"2026-02-06 09:30:00",updatedAt:"2026-02-06 10:00:00",changeType:"modify",scenario:"任务编辑模式",phase:"dev_review",messages:[{id:"msg-edit-1",role:"user",content:"编辑任务 dm_user_order_stats_df，需要新增退款相关指标的统计，并优化调度配置",timestamp:"2026-02-06 09:30:00"},{id:"msg-edit-2",role:"assistant",content:"好的，我已根据您的需求修改了任务 **dm_user_order_stats_df**。\n\n修改内容包括：\n\n**SQL 变更**\n- 新增字段 `refund_count` 计算退款订单数\n- 新增字段 `refund_amount` 计算退款金额\n- 优化 `avg_order_amount` 计算逻辑，排除退款订单\n\n**调度配置变更**\n- 调整执行时间从 02:00 改为 03:00\n- 新增重试策略，失败后自动重试 3 次\n- 新增超时配置\n- 增加邮件告警渠道\n\n请查看左侧的 **Diff** 视图确认变更，确认后可采纳。",timestamp:"2026-02-06 10:00:00",relatedArtifacts:["artifact-edit-1","artifact-edit-2"]}],artifactIds:["artifact-edit-1","artifact-edit-2"]}],eD=[{id:"artifact-plan-1",name:"实时礼物榜单开发计划",type:"plan",path:"LeapAgentDemos/plan_mode_demo",currentVersion:"v1",createdAt:"2025-12-08 09:00:00",updatedAt:"2025-12-08 09:05:00",owner:"shenyulin.sanshui",changeType:"create",versions:[{id:"v1-plan-1",version:"v1",status:"approved",createdAt:"2025-12-08 09:05:00",createdBy:"AI Assistant",changeDescription:"生成开发计划",sessionId:"session-plan-1",yamlContent:"# 实时礼物榜单开发计划\n\n## 1. 需求分析\n\n### 1.1 业务背景\n实现直播间实时礼物榜单功能，展示用户送礼排名，提升直播互动性。\n\n### 1.2 功能需求\n- 实时统计用户送礼金额\n- 按直播间维度聚合\n- 支持 Top N 榜单展示\n- 支持实时刷新（秒级延迟）\n\n## 2. 技术方案\n\n### 2.1 数据流设计\n```\n礼物流水 → Kafka → Flink → Redis → 榜单服务\n```\n\n### 2.2 产物清单\n\n| 产物类型 | 名称 | 说明 |\n|---------|------|------|\n| 离线任务 | gift_ranking_init_df | 历史数据初始化任务 |\n| 数据表 | dwd_gift_ranking_df | 礼物榜单明细表 |\n| DTS配置 | dts_gift_stream_sync | 实时同步配置 |\n| 测试报告 | test_report_gift_ranking | 功能验证报告 |\n\n### 2.3 时间计划\n- Day 1: 表结构设计与创建\n- Day 2: 离线任务开发\n- Day 3: 实时同步配置\n- Day 4: 测试验证\n\n## 3. 风险评估\n\n| 风险项 | 等级 | 缓解措施 |\n|--------|------|---------|\n| 数据量大导致性能问题 | 中 | 增加分区，优化索引 |\n| 实时同步延迟 | 低 | 监控告警，自动扩容 |\n\n## 4. 验收标准\n- [ ] 数据准确性 > 99.99%\n- [ ] 端到端延迟 < 3s\n- [ ] 系统可用性 > 99.9%\n\n## 5. 待办事项 (Todo)\n- [ ] 确认 Flink 集群资源配额\n- [ ] 申请 Kafka Topic 读写权限\n- [ ] Review 离线任务代码\n\n## 6. 待澄清问题 (Questions)\n- **Q1**: 榜单数据保留多久？（建议默认 24h）\n- **Q2**: 是否需要支持历史数据回溯？（当前方案不支持）\n"}]},{id:"artifact-pg-1",name:"gift_ranking_init_df",type:"task",path:"LeapAgentDemos/plan_mode_demo",currentVersion:"v1",createdAt:"2025-12-08 10:00:00",updatedAt:"2025-12-08 10:00:00",owner:"shenyulin.sanshui",changeType:"create",groupId:"group-gift-ranking-1",versions:[{id:"v1-pg-1",version:"v1",status:"pending_review",createdAt:"2025-12-08 10:00:00",createdBy:"AI Assistant",changeDescription:"基于计划生成 - 历史数据初始化任务",sessionId:"session-plan-1",yamlContent:"-- ***************************************************************\n-- 基于开发计划自动生成\n-- Author: AI Assistant\n-- CreateTime: 2025-12-08 10:00:00\n-- Description: 礼物榜单历史数据初始化\n-- ***************************************************************\n\nINSERT OVERWRITE TABLE copilot_demo.dwd_gift_ranking_df\n  PARTITION(dt='${date}')\nSELECT\n    live_room_id,\n    user_id,\n    SUM(gift_amount) AS total_amount,\n    COUNT(*) AS gift_count,\n    MAX(gift_time) AS last_gift_time,\n    ROW_NUMBER() OVER (\n        PARTITION BY live_room_id \n        ORDER BY SUM(gift_amount) DESC\n    ) AS ranking\nFROM copilot_demo.dwd_gift_detail_df\nWHERE dt = '${date}'\nGROUP BY live_room_id, user_id\nORDER BY total_amount DESC;"}]},{id:"artifact-pg-2",name:"dwd_gift_ranking_df",type:"table",path:"LeapAgentDemos/plan_mode_demo",currentVersion:"v1",createdAt:"2025-12-08 10:00:00",updatedAt:"2025-12-08 10:00:00",owner:"shenyulin.sanshui",changeType:"create",versions:[{id:"v1-pg-2",version:"v1",status:"pending_review",createdAt:"2025-12-08 10:00:00",createdBy:"AI Assistant",changeDescription:"基于计划生成 - 礼物榜单明细表",sessionId:"session-plan-1",yamlContent:"-- 基于开发计划自动生成\nCREATE TABLE IF NOT EXISTS copilot_demo.dwd_gift_ranking_df (\n    live_room_id STRING COMMENT '直播间ID',\n    user_id STRING COMMENT '用户ID',\n    total_amount DECIMAL(18,2) COMMENT '累计送礼金额',\n    gift_count INT COMMENT '送礼次数',\n    last_gift_time TIMESTAMP COMMENT '最后送礼时间',\n    ranking INT COMMENT '榜单排名'\n)\nCOMMENT '直播间礼物榜单表'\nPARTITIONED BY (dt STRING COMMENT '分区日期')\nSTORED AS ORC\nLOCATION '/warehouse/copilot_demo/dwd_gift_ranking_df'\nTBLPROPERTIES (\n    'orc.compress' = 'SNAPPY',\n    'transactional' = 'false'\n);"}]},{id:"artifact-pg-3",name:"gift_ranking_init_df.config",type:"config",path:"LeapAgentDemos/plan_mode_demo",currentVersion:"v1",createdAt:"2025-12-08 10:00:00",updatedAt:"2025-12-08 10:00:00",owner:"shenyulin.sanshui",changeType:"create",groupId:"group-gift-ranking-1",versions:[{id:"v1-pg-3",version:"v1",status:"pending_review",createdAt:"2025-12-08 10:00:00",createdBy:"AI Assistant",changeDescription:"基于计划生成 - 任务调度配置",sessionId:"session-plan-1",yamlContent:'# 任务调度配置\n任务名称: gift_ranking_init_df\n任务类型: HiveSQL\n\n调度配置:\n  调度周期: 每天\n  执行时间: "02:00"\n  依赖任务:\n    - dwd_gift_detail_df\n  超时时间: 3600秒\n  重试策略:\n    最大重试次数: 3\n    重试间隔: 300秒\n\n告警配置:\n  告警类型:\n    - 执行失败\n    - 执行超时\n  告警渠道:\n    - 飞书\n    - 短信\n  告警接收人:\n    - shenyulin.sanshui'}]},{id:"artifact-pg-4",name:"dts_hive2ck_gift_ranking",type:"task",path:"LeapAgentDemos/plan_mode_demo",currentVersion:"v1",createdAt:"2025-12-08 10:30:00",updatedAt:"2025-12-08 10:30:00",owner:"shenyulin.sanshui",changeType:"create",groupId:"group-dts-gift-ranking",versions:[{id:"v1-pg-4",version:"v1",status:"pending_review",createdAt:"2025-12-08 10:30:00",createdBy:"AI Assistant",changeDescription:"DTS Hive2CK 数据同步任务 - 礼物榜单同步至 ClickHouse",sessionId:"session-plan-1",yamlContent:'# ***************************************************************\n# DTS 数据集成任务配置\n# Author: AI Assistant\n# CreateTime: 2025-12-08 10:30:00\n# Description: Hive to ClickHouse 数据同步任务\n# ***************************************************************\n\n数据来源:\n  数据源类型: hive\n  参数:\n    机房: default\n    同步方式: table\n    源数据库名: copilot_demo\n    源表名: dwd_gift_ranking_df\n    分区字段列表:\n      - 分区名: dt\n        分区类型: string\n        分区值: ${date}\n    字段映射列表:\n      - 类型: bigint\n        源表字段: live_room_id\n        描述: 直播间ID\n      - 类型: bigint\n        源表字段: user_id\n        描述: 用户ID\n      - 类型: decimal\n        源表字段: total_amount\n        描述: 总金额\n      - 类型: bigint\n        源表字段: gift_count\n        描述: 礼物数量\n      - 类型: bigint\n        源表字段: ranking\n        描述: 排名\n\n写入目标:\n  写入目标类型: clickhouse\n  参数:\n    集群名称: ck_cluster_default\n    目标数据库名: dm_ck\n    目标表名: dwd_gift_ranking_df_ck\n    表引擎: ReplicatedMergeTree\n    分区键: toYYYYMMDD(toDate(dt))\n    排序键: (live_room_id, ranking)\n\n同步配置:\n  同步模式: incremental\n  调度周期: daily\n  执行时间: "04:00"\n  并行度: 4\n  批量大小: 50000\n  数据校验: true\n  失败告警: true'}]},{id:"artifact-pg-5",name:"dwd_gift_ranking_df_ck",type:"table",path:"LeapAgentDemos/plan_mode_demo",currentVersion:"v1",createdAt:"2025-12-08 10:30:00",updatedAt:"2025-12-08 10:30:00",owner:"shenyulin.sanshui",changeType:"create",groupId:"group-dts-gift-ranking",versions:[{id:"v1-pg-5",version:"v1",status:"pending_review",createdAt:"2025-12-08 10:30:00",createdBy:"AI Assistant",changeDescription:"ClickHouse 目标表 - 礼物榜单同步表",sessionId:"session-plan-1",yamlContent:"-- ***************************************************************\n-- 基于AI引擎自动生成\n-- Author: AI Assistant\n-- CreateTime: 2025-12-08 10:30:00\n-- Description: ClickHouse 礼物榜单表\n-- ***************************************************************\n\nCREATE TABLE IF NOT EXISTS dm_ck.dwd_gift_ranking_df_ck\nON CLUSTER ck_cluster_default\n(\n    live_room_id Int64 COMMENT '直播间ID',\n    user_id Int64 COMMENT '用户ID',\n    total_amount Decimal64(2) COMMENT '总金额',\n    gift_count Int64 COMMENT '礼物数量',\n    ranking Int64 COMMENT '排名',\n    dt String COMMENT '日期分区'\n)\nENGINE = ReplicatedMergeTree('/clickhouse/tables/{shard}/dwd_gift_ranking_df_ck', '{replica}')\nPARTITION BY toYYYYMMDD(toDate(dt))\nORDER BY (live_room_id, ranking)\nSETTINGS index_granularity = 8192;"}]},{id:"artifact-pg-6",name:"gift_ranking_test_report_20251208",type:"report",path:"LeapAgentDemos/plan_mode_demo",currentVersion:"v1",createdAt:"2025-12-08 10:35:00",updatedAt:"2025-12-08 10:35:00",owner:"shenyulin.sanshui",changeType:"create",groupId:"group-gift-ranking-1",versions:[{id:"v1-pg-6",version:"v1",status:"pending_review",createdAt:"2025-12-08 10:35:00",createdBy:"AI Assistant",changeDescription:"基于计划生成 - 自动化测试报告",sessionId:"session-plan-1",yamlContent:"# 礼物榜单任务测试报告\n\n## 1. 测试概览\n- **测试任务**: gift_ranking_init_df\n- **测试时间**: 2025-12-08 10:35:00\n- **测试环境**: 预发环境 (Staging)\n- **测试结论**: **通过 (PASS)**\n\n## 2. 核心指标校验\n| 指标名称 | 预期逻辑 | 校验结果 | 差异率 |\n| :--- | :--- | :--- | :--- |\n| total_amount | 聚合金额须等于明细表总和 | Consistent | 0.00% |\n| gift_count | 聚合次数须等于明细行数 | Consistent | 0.00% |\n| ranking | 排名连续无断层 | Valid | - |\n\n## 3. 数据质量检查\n- **空值检查**: \n  - live_room_id: 0 nulls (Pass)\n  - user_id: 0 nulls (Pass)\n- **主键唯一性**:\n  - (live_room_id, user_id): Unique (Pass)\n- **数据量级**:\n  - 源表行数: 1,500,230\n  - 产出表行数: 120,050 (聚合后)\n\n## 4. 性能评估\n- **执行耗时**: 45s (SLA < 5min)\n- **资源消耗**: Reduces shuffled data by 80% due to local aggregation optimization.\n\n## 5. 建议\n任务逻辑正确，数据质量符合预期，建议上线。"}]},{id:"artifact-1",name:"ads_live_transaction_summary_df",type:"task",path:"LeapAgentDemos/V1.0_Dogfooding_case",currentVersion:"v1",createdAt:"2025-11-06 11:40:50",updatedAt:"2025-11-06 11:40:50",owner:"shenyulin.sanshui",changeType:"create",versions:[{id:"v1-artifact-1",version:"v1",status:"pending_review",createdAt:"2025-11-06 11:40:50",createdBy:"AI Assistant",changeDescription:"新建交易汇总任务",sessionId:"session-dogfooding-1",yamlContent:"-- ***************************************************************\n-- Author: shenyulin.sanshui\n-- CreateTime: 2025-11-06 11:40:50\n-- Description: 新建 - 交易汇总任务\n-- ***************************************************************\n-- 功能：从交易原始表提取送礼记录并解析JSON扩展字段\n\nINSERT OVERWRITE TABLE copilot_demo.dwd_gift_detail \n  PARTITION(date='${date}')\nSELECT\n    t.transaction_id,\n    t.user_id,\n    t.live_room_id,\n    t.amount AS gift_amount,\n    t.transaction_time AS gift_time,\n    get_json_object(t.ext_json, '$.receiver_id') AS receiver_user_id\nFROM\n    copilot_demo.ods_live_transaction t\nWHERE\n    t.transaction_type = 'gift'\n    AND t.status = 'success'\n    AND t.date = '${date}';"}]},{id:"artifact-2",name:"dwd_gift_detail_df",type:"table",path:"LeapAgentDemos/V1.0_Dogfooding_case",currentVersion:"v1",createdAt:"2025-11-06 11:45:00",updatedAt:"2025-11-06 11:45:00",owner:"shenyulin.sanshui",changeType:"create",versions:[{id:"v1-artifact-2",version:"v1",status:"pending_review",createdAt:"2025-11-06 11:45:00",createdBy:"AI Assistant",changeDescription:"新建礼物明细表",sessionId:"session-dogfooding-1",yamlContent:"CREATE TABLE IF NOT EXISTS copilot_demo.dwd_gift_detail (\n    transaction_id STRING COMMENT '交易ID',\n    user_id STRING COMMENT '用户ID',\n    live_room_id STRING COMMENT '直播间ID',\n    gift_amount DECIMAL(18,2) COMMENT '礼物金额',\n    gift_time TIMESTAMP COMMENT '送礼时间',\n    receiver_user_id STRING COMMENT '收礼用户ID'\n)\nPARTITIONED BY (date STRING COMMENT '分区日期')\nSTORED AS ORC\nLOCATION '/warehouse/copilot_demo/dwd_gift_detail'\nTBLPROPERTIES (\n    'orc.compress' = 'SNAPPY',\n    'transactional' = 'false'\n);"}]},{id:"artifact-3",name:"测试报告_122397548_ads_live",type:"report",path:"LeapAgentDemos/V1.0_Dogfooding_case",currentVersion:"v1",createdAt:"2025-11-06 14:00:00",updatedAt:"2025-11-06 14:00:00",owner:"shenyulin.sanshui",changeType:"create",versions:[{id:"v1-artifact-3",version:"v1",status:"pending_review",createdAt:"2025-11-06 14:00:00",createdBy:"AI Assistant",changeDescription:"自动生成测试报告",sessionId:"session-dogfooding-1",yamlContent:"# 测试报告\n## 基本信息\n- 任务名称: ads_live_transaction_summary_df\n- 测试时间: 2025-11-06 14:00:00\n- 测试人员: AI Assistant\n\n## 测试结果\n| 测试项 | 结果 | 说明 |\n|--------|------|------|\n| 语法检查 | PASS | SQL语法正确 |\n| 数据一致性 | PASS | 生产vs测试数据对比一致 |\n| 性能测试 | PASS | 执行时间 < 5min |\n| 数据质量 | PASS | 无空值异常 |\n\n## 数据校验详情\n- 总记录数: 1,234,567\n- 空值率: 0.01%\n- 重复率: 0%"}]},{id:"artifact-4",name:"新增指标_20251206145615",type:"task",path:"luzhongxian/shenyulin_test",currentVersion:"v2",createdAt:"2025-12-06 14:56:15",updatedAt:"2025-12-07 10:30:00",owner:"luzhongxian",changeType:"modify",versions:[{id:"v1-artifact-4",version:"v1",status:"deployed",createdAt:"2025-12-06 14:56:15",createdBy:"luzhongxian",changeDescription:"初始版本 - 用户活跃度指标",sessionId:"session-shenyulin-old",yamlContent:"-- 用户活跃度指标计算\n-- DAU/MAU 统计\n\nSELECT\n    date,\n    COUNT(DISTINCT user_id) AS dau,\n    COUNT(DISTINCT CASE \n        WHEN date >= date_sub(current_date, 30) \n        THEN user_id \n    END) AS mau\nFROM user_activity_log\nWHERE date >= date_sub(current_date, 30)\nGROUP BY date;"},{id:"v2-artifact-4",version:"v2",status:"pending_review",createdAt:"2025-12-07 10:30:00",createdBy:"AI Assistant",changeDescription:"优化指标计算逻辑，新增WAU指标",sessionId:"session-shenyulin-1",previousContent:"-- 用户活跃度指标计算\n-- DAU/MAU 统计\n\nSELECT\n    date,\n    COUNT(DISTINCT user_id) AS dau,\n    COUNT(DISTINCT CASE \n        WHEN date >= date_sub(current_date, 30) \n        THEN user_id \n    END) AS mau\nFROM user_activity_log\nWHERE date >= date_sub(current_date, 30)\nGROUP BY date;",yamlContent:"-- 用户活跃度指标计算（优化版）\n-- DAU/WAU/MAU 统计\n-- 更新: 新增WAU指标，优化计算性能\n\nSELECT\n    date,\n    COUNT(DISTINCT user_id) AS dau,\n    COUNT(DISTINCT CASE \n        WHEN date >= date_sub(current_date, 7) \n        THEN user_id \n    END) AS wau,\n    COUNT(DISTINCT CASE \n        WHEN date >= date_sub(current_date, 30) \n        THEN user_id \n    END) AS mau,\n    -- 新增: 活跃度趋势\n    ROUND(dau * 1.0 / mau, 4) AS daily_active_rate\nFROM user_activity_log\nWHERE date >= date_sub(current_date, 30)\nGROUP BY date\nORDER BY date DESC;"}]},{id:"artifact-5",name:"智能建改表_20251111104043",type:"table",path:"luzhongxian/shenyulin_test",currentVersion:"v2",createdAt:"2025-11-11 10:40:43",updatedAt:"2025-11-12 09:15:00",owner:"luzhongxian",changeType:"modify",versions:[{id:"v1-artifact-5",version:"v1",status:"deployed",createdAt:"2025-11-11 10:40:43",createdBy:"luzhongxian",changeDescription:"原表结构",sessionId:"session-shenyulin-old",yamlContent:"CREATE TABLE copilot_demo.dwd_gift_detail_df (\n    transaction_id STRING COMMENT '交易ID',\n    user_id STRING COMMENT '用户ID',\n    live_room_id STRING COMMENT '直播间ID',\n    gift_amount DECIMAL(18,2) COMMENT '礼物金额',\n    gift_time TIMESTAMP COMMENT '送礼时间'\n)\nPARTITIONED BY (date STRING COMMENT '分区日期')\nSTORED AS ORC;"},{id:"v2-artifact-5",version:"v2",status:"pending_review",createdAt:"2025-11-12 09:15:00",createdBy:"AI Assistant",changeDescription:"智能优化表结构 - 新增字段和索引",sessionId:"session-shenyulin-1",previousContent:"CREATE TABLE copilot_demo.dwd_gift_detail_df (\n    transaction_id STRING COMMENT '交易ID',\n    user_id STRING COMMENT '用户ID',\n    live_room_id STRING COMMENT '直播间ID',\n    gift_amount DECIMAL(18,2) COMMENT '礼物金额',\n    gift_time TIMESTAMP COMMENT '送礼时间'\n)\nPARTITIONED BY (date STRING COMMENT '分区日期')\nSTORED AS ORC;",yamlContent:"-- 智能建改表建议\n-- 原表: dwd_gift_detail_df\n-- 变更类型: ALTER TABLE\n\nALTER TABLE copilot_demo.dwd_gift_detail_df\nADD COLUMNS (\n    receiver_user_id STRING COMMENT '收礼用户ID',\n    gift_type STRING COMMENT '礼物类型',\n    gift_category STRING COMMENT '礼物分类',\n    is_combo BOOLEAN COMMENT '是否连击',\n    combo_count INT COMMENT '连击次数'\n);\n\n-- 添加二级索引建议\nCREATE INDEX idx_user_time \nON TABLE copilot_demo.dwd_gift_detail_df (user_id, gift_time)\nAS 'COMPACT' WITH DEFERRED REBUILD;\n\n-- 添加分区策略优化\nALTER TABLE copilot_demo.dwd_gift_detail_df\nSET TBLPROPERTIES ('orc.compress' = 'ZLIB');"}]},{id:"artifact-6",name:"dts_sync_config_user_activity",type:"config",path:"luzhongxian/shenyulin_test",currentVersion:"v2",createdAt:"2025-12-06 15:30:00",updatedAt:"2025-12-07 11:00:00",owner:"luzhongxian",changeType:"modify",versions:[{id:"v1-artifact-6",version:"v1",status:"deployed",createdAt:"2025-12-06 15:30:00",createdBy:"luzhongxian",changeDescription:"初始版本 - 用户活动数据同步配置",sessionId:"session-shenyulin-old",yamlContent:'# DTS 同步配置\nname: user_activity_sync\ntype: full_sync\n\nsource:\n  type: mysql\n  host: source-db.example.com\n  port: 3306\n  database: user_system\n  table: user_activity_log\n\ntarget:\n  type: hive\n  database: dw_user\n  table: ods_user_activity_log\n  partition_column: dt\n\nsync_settings:\n  batch_size: 10000\n  parallel_threads: 4\n  \nschedule:\n  cron: "0 2 * * *"\n  timezone: Asia/Shanghai'},{id:"v2-artifact-6",version:"v2",status:"pending_review",createdAt:"2025-12-07 11:00:00",createdBy:"AI Assistant",changeDescription:"优化同步配置 - 增加增量同步和监控",sessionId:"session-shenyulin-1",previousContent:'# DTS 同步配置\nname: user_activity_sync\ntype: full_sync\n\nsource:\n  type: mysql\n  host: source-db.example.com\n  port: 3306\n  database: user_system\n  table: user_activity_log\n\ntarget:\n  type: hive\n  database: dw_user\n  table: ods_user_activity_log\n  partition_column: dt\n\nsync_settings:\n  batch_size: 10000\n  parallel_threads: 4\n  \nschedule:\n  cron: "0 2 * * *"\n  timezone: Asia/Shanghai',yamlContent:'# DTS 同步配置（优化版）\nname: user_activity_sync\ntype: incremental_sync  # 改为增量同步\n\nsource:\n  type: mysql\n  host: source-db.example.com\n  port: 3306\n  database: user_system\n  table: user_activity_log\n  # 新增: 增量字段配置\n  incremental_column: update_time\n  incremental_type: timestamp\n\ntarget:\n  type: hive\n  database: dw_user\n  table: ods_user_activity_log\n  partition_column: dt\n\nsync_settings:\n  batch_size: 50000  # 优化: 增大批次\n  parallel_threads: 8  # 优化: 增加并发\n  checkpoint_interval: 60s\n  # 新增: 失败重试配置\n  retry_count: 3\n  retry_interval: 30s\n\n# 新增: 监控告警配置\nmonitoring:\n  enable: true\n  alert_threshold:\n    delay_minutes: 30\n    error_rate: 0.01\n  notify:\n    - type: dingding\n      webhook: https://oapi.dingtalk.com/robot/send?access_token=xxx\n  \nschedule:\n  cron: "*/30 * * * *"  # 优化: 每30分钟执行\n  timezone: Asia/Shanghai'}]},{id:"artifact-edit-1",name:"dm_user_order_stats_df",type:"task",path:"LeapAgentDemos/edit_session",currentVersion:"v2",createdAt:"2025-12-01 10:00:00",updatedAt:"2026-02-06 10:00:00",owner:"shenyulin.sanshui",changeType:"modify",groupId:"group-edit-user-order",versions:[{id:"v1-edit-1",version:"v1",status:"deployed",createdAt:"2025-12-01 10:00:00",createdBy:"shenyulin.sanshui",changeDescription:"初始版本 - 用户订单统计任务",sessionId:"session-old-1",yamlContent:"-- ***************************************************************\n-- Author: shenyulin.sanshui\n-- CreateTime: 2025-12-01 10:00:00\n-- Description: 用户订单统计 - 日维度聚合\n-- ***************************************************************\n\nINSERT OVERWRITE TABLE dm.dm_user_order_stats_df\n  PARTITION(dt='${date}')\nSELECT\n    user_id,\n    COUNT(order_id) AS order_count,\n    SUM(order_amount) AS total_amount,\n    SUM(order_amount) / COUNT(order_id) AS avg_order_amount,\n    MIN(order_time) AS first_order_time,\n    MAX(order_time) AS last_order_time\nFROM\n    dwd.dwd_order_df\nWHERE\n    dt = '${date}'\n    AND order_status = 'completed'\nGROUP BY\n    user_id;"},{id:"v2-edit-1",version:"v2",status:"pending_review",createdAt:"2026-02-06 10:00:00",createdBy:"AI Assistant",changeDescription:"新增退款指标，优化均价计算逻辑",sessionId:"session-edit-1",yamlContent:"-- ***************************************************************\n-- Author: shenyulin.sanshui\n-- CreateTime: 2025-12-01 10:00:00\n-- UpdateTime: 2026-02-06 10:00:00\n-- Description: 用户订单统计 - 日维度聚合（含退款指标）\n-- ***************************************************************\n\nINSERT OVERWRITE TABLE dm.dm_user_order_stats_df\n  PARTITION(dt='${date}')\nSELECT\n    user_id,\n    COUNT(order_id) AS order_count,\n    SUM(order_amount) AS total_amount,\n    -- 优化：排除退款订单计算平均金额\n    SUM(CASE WHEN refund_status = 'none' THEN order_amount ELSE 0 END) /\n      NULLIF(SUM(CASE WHEN refund_status = 'none' THEN 1 ELSE 0 END), 0) AS avg_order_amount,\n    -- 新增：退款订单数\n    SUM(CASE WHEN refund_status = 'refunded' THEN 1 ELSE 0 END) AS refund_count,\n    -- 新增：退款金额\n    SUM(CASE WHEN refund_status = 'refunded' THEN order_amount ELSE 0 END) AS refund_amount,\n    MIN(order_time) AS first_order_time,\n    MAX(order_time) AS last_order_time\nFROM\n    dwd.dwd_order_df\nWHERE\n    dt = '${date}'\n    AND order_status IN ('completed', 'refunded')\nGROUP BY\n    user_id;",previousContent:"-- ***************************************************************\n-- Author: shenyulin.sanshui\n-- CreateTime: 2025-12-01 10:00:00\n-- Description: 用户订单统计 - 日维度聚合\n-- ***************************************************************\n\nINSERT OVERWRITE TABLE dm.dm_user_order_stats_df\n  PARTITION(dt='${date}')\nSELECT\n    user_id,\n    COUNT(order_id) AS order_count,\n    SUM(order_amount) AS total_amount,\n    SUM(order_amount) / COUNT(order_id) AS avg_order_amount,\n    MIN(order_time) AS first_order_time,\n    MAX(order_time) AS last_order_time\nFROM\n    dwd.dwd_order_df\nWHERE\n    dt = '${date}'\n    AND order_status = 'completed'\nGROUP BY\n    user_id;"}]},{id:"artifact-edit-2",name:"dm_user_order_stats_df.config",type:"config",path:"LeapAgentDemos/edit_session",currentVersion:"v2",createdAt:"2025-12-01 10:00:00",updatedAt:"2026-02-06 10:00:00",owner:"shenyulin.sanshui",changeType:"modify",groupId:"group-edit-user-order",versions:[{id:"v1-edit-2",version:"v1",status:"deployed",createdAt:"2025-12-01 10:00:00",createdBy:"shenyulin.sanshui",changeDescription:"初始调度配置",sessionId:"session-old-1",yamlContent:'# 调度配置 - 用户订单统计任务\ntask_name: dm_user_order_stats_df\nschedule:\n  type: daily\n  cron: "0 2 * * *"  # 每天凌晨2点执行\n  timezone: Asia/Shanghai\n\ndependencies:\n  - name: dwd.dwd_order_df\n    type: table\n    partition: dt=${date}\n\nresources:\n  memory: 4G\n  cpu: 2\n  executor_instances: 10\n\nalert:\n  on_failure: true\n  channels:\n    - type: lark\n      webhook: https://open.xxx.cn/open-apis/bot/v2/hook/xxx'},{id:"v2-edit-2",version:"v2",status:"pending_review",createdAt:"2026-02-06 10:00:00",createdBy:"AI Assistant",changeDescription:"调整执行时间，新增重试策略",sessionId:"session-edit-1",yamlContent:'# 调度配置 - 用户订单统计任务\ntask_name: dm_user_order_stats_df\nschedule:\n  type: daily\n  cron: "0 3 * * *"  # 调整为凌晨3点执行（原2点）\n  timezone: Asia/Shanghai\n\ndependencies:\n  - name: dwd.dwd_order_df\n    type: table\n    partition: dt=${date}\n\nresources:\n  memory: 8G   # 提升内存配置\n  cpu: 4       # 提升CPU配置\n  executor_instances: 20\n\n# 新增：重试策略\nretry:\n  enabled: true\n  max_attempts: 3\n  interval: 300  # 5分钟后重试\n  exponential_backoff: true\n\n# 新增：超时配置\ntimeout:\n  execution: 3600  # 1小时超时\n  queue: 1800      # 30分钟排队超时\n\nalert:\n  on_failure: true\n  on_timeout: true\n  on_retry: true\n  channels:\n    - type: lark\n      webhook: https://open.xxx.cn/open-apis/bot/v2/hook/xxx\n    - type: email\n      recipients:\n        - shenyulin@xxx.com',previousContent:'# 调度配置 - 用户订单统计任务\ntask_name: dm_user_order_stats_df\nschedule:\n  type: daily\n  cron: "0 2 * * *"  # 每天凌晨2点执行\n  timezone: Asia/Shanghai\n\ndependencies:\n  - name: dwd.dwd_order_df\n    type: table\n    partition: dt=${date}\n\nresources:\n  memory: 4G\n  cpu: 2\n  executor_instances: 10\n\nalert:\n  on_failure: true\n  channels:\n    - type: lark\n      webhook: https://open.xxx.cn/open-apis/bot/v2/hook/xxx'}]}];function eO(e){let{content:t,readOnly:s=!0}=e,r=t.split("\n");return(0,n.jsx)(N,{className:"h-full",children:(0,n.jsx)("div",{className:"min-h-full bg-background p-4 font-mono text-sm",children:(0,n.jsx)("table",{className:"w-full border-collapse",children:(0,n.jsx)("tbody",{children:r.map((e,t)=>(0,n.jsxs)("tr",{className:"group",children:[(0,n.jsx)("td",{className:"w-12 select-none pr-4 text-right text-xs text-muted-foreground/50 group-hover:text-muted-foreground",children:t+1}),(0,n.jsx)("td",{className:"whitespace-pre text-foreground",children:function(e){let t;if(e.trim().startsWith("--")||e.trim().startsWith("#"))return(0,n.jsx)("span",{className:"text-emerald-400",children:e});if(e.includes(":")&&!e.trim().startsWith("--")){let t=e.indexOf(":"),s=e.substring(0,t),r=e.substring(t);if(/^\s*[a-zA-Z_][a-zA-Z0-9_]*\s*$/.test(s)||/^\s*-\s*[a-zA-Z_]/.test(s))return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("span",{className:"text-cyan-400",children:s}),(0,n.jsx)("span",{className:"text-foreground",children:r})]})}let s=[],r=0,a=RegExp(/\b(SELECT|FROM|WHERE|INSERT|UPDATE|DELETE|CREATE|TABLE|INTO|VALUES|AND|OR|AS|JOIN|LEFT|RIGHT|INNER|OUTER|ON|GROUP|BY|ORDER|HAVING|LIMIT|OFFSET|PARTITION|OVERWRITE|IF|NOT|EXISTS|CASE|WHEN|THEN|ELSE|END|DISTINCT|COUNT|SUM|AVG|MAX|MIN|CAST|BIGINT|STRING|INT|DECIMAL|TIMESTAMP|BOOLEAN|COMMENT|STORED|ORC|LOCATION|TBLPROPERTIES|ALTER|ADD|COLUMNS|DROP|INDEX|WITH|DISTRIBUTE|LATERAL|VIEW)\b/gi.source,"gi");for(;null!==(t=a.exec(e));)t.index>r&&s.push(e.substring(r,t.index)),s.push((0,n.jsx)("span",{className:"text-blue-400 font-medium",children:t[0]},t.index)),r=a.lastIndex;return r<e.length&&s.push(e.substring(r)),s.length>0?s:e}(e)})]},t))})})})})}var eM=s(370);function eL(e){let{className:t,...s}=e;return(0,n.jsx)(eM.f,{"data-slot":"label",className:m("flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",t),...s})}var eR=s(721);function ez(e){let{className:t,...s}=e;return(0,n.jsx)(eR.fC,{"data-slot":"switch",className:m("peer data-[state=checked]:bg-primary data-[state=unchecked]:bg-input focus-visible:border-ring focus-visible:ring-ring/50 dark:data-[state=unchecked]:bg-input/80 inline-flex h-[1.15rem] w-8 shrink-0 items-center rounded-full border border-transparent shadow-xs transition-all outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",t),...s,children:(0,n.jsx)(eR.bU,{"data-slot":"switch-thumb",className:"bg-background dark:data-[state=unchecked]:bg-foreground dark:data-[state=checked]:bg-primary-foreground pointer-events-none block size-4 rounded-full ring-0 transition-transform data-[state=checked]:translate-x-[calc(100%-2px)] data-[state=unchecked]:translate-x-0"})})}var eZ=s(9270);function eV(e){let{className:t,...s}=e;return(0,n.jsx)(eZ.fC,{"data-slot":"checkbox",className:m("peer border-input dark:bg-input/30 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground dark:data-[state=checked]:bg-primary data-[state=checked]:border-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive size-4 shrink-0 rounded-[4px] border shadow-xs transition-shadow outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",t),...s,children:(0,n.jsx)(eZ.z$,{"data-slot":"checkbox-indicator",className:"flex items-center justify-center text-current transition-none",children:(0,n.jsx)(K.Z,{className:"size-3.5"})})})}var eH=s(2325),eP=s(519);function eB(e){let{className:t,...s}=e;return(0,n.jsx)(eH.fC,{"data-slot":"radio-group",className:m("grid gap-3",t),...s})}function eU(e){let{className:t,...s}=e;return(0,n.jsx)(eH.ck,{"data-slot":"radio-group-item",className:m("border-input text-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 aspect-square size-4 shrink-0 rounded-full border shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",t),...s,children:(0,n.jsx)(eH.z$,{"data-slot":"radio-group-indicator",className:"relative flex items-center justify-center",children:(0,n.jsx)(eP.Z,{className:"fill-primary absolute top-1/2 left-1/2 size-2 -translate-x-1/2 -translate-y-1/2"})})})}var eW=s(1047),eF=s(9397);function eq(e){let{artifact:t,version:s,editedContent:r,onContentChange:a}=e;return(0,n.jsx)(N,{className:"h-full overflow-auto bg-background",children:(()=>{switch(t.type){case"task":return(0,n.jsx)(eG,{artifact:t,version:s,content:r,onContentChange:a});case"table":return(0,n.jsx)(eX,{artifact:t,version:s});case"config":return(0,n.jsx)(eK,{artifact:t,version:s,content:r,onContentChange:a});case"report":return(0,n.jsx)(e0,{artifact:t,version:s});default:return null}})()})}function eG(e){let{artifact:t,version:s,content:r,onContentChange:a}=e;return t.name.includes("dts")||t.name.includes("hive2ck")?(0,n.jsx)(e$,{artifact:t,version:s,content:r,onContentChange:a}):(0,n.jsxs)("div",{className:"space-y-6 p-4",children:[(0,n.jsxs)("section",{className:"space-y-4",children:[(0,n.jsx)("h3",{className:"text-sm font-medium text-foreground",children:"基础信息"}),(0,n.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)(eL,{className:"text-xs text-muted-foreground",children:"任务名称"}),(0,n.jsx)(b,{value:t.name,readOnly:!0,className:"h-8 border-border bg-input text-xs text-foreground"})]}),(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)(eL,{className:"text-xs text-muted-foreground",children:"任务类型"}),(0,n.jsx)("div",{className:"flex h-8 items-center rounded-md border border-border bg-input px-3",children:(0,n.jsx)(el,{className:"bg-amber-500/20 text-amber-400 text-xs",children:"HiveSQL"})})]}),(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)(eL,{className:"text-xs text-muted-foreground",children:"执行引擎"}),(0,n.jsxs)(ee,{defaultValue:"spark",children:[(0,n.jsx)(es,{className:"h-8 border-border bg-input text-xs text-foreground",children:(0,n.jsx)(et,{})}),(0,n.jsxs)(en,{className:"border-border bg-popover",children:[(0,n.jsx)(er,{value:"spark",children:"Spark"}),(0,n.jsx)(er,{value:"hive",children:"Hive"}),(0,n.jsx)(er,{value:"presto",children:"Presto"})]})]})]}),(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)(eL,{className:"text-xs text-muted-foreground",children:"负责人"}),(0,n.jsx)(b,{value:t.owner,readOnly:!0,className:"h-8 border-border bg-input text-xs text-foreground"})]})]})]}),(0,n.jsxs)("section",{className:"space-y-4",children:[(0,n.jsx)("h3",{className:"text-sm font-medium text-foreground",children:"调度配置"}),(0,n.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)(eL,{className:"text-xs text-muted-foreground",children:"调度周期"}),(0,n.jsxs)(ee,{defaultValue:"daily",children:[(0,n.jsx)(es,{className:"h-8 border-border bg-input text-xs text-foreground",children:(0,n.jsx)(et,{})}),(0,n.jsxs)(en,{className:"border-border bg-popover",children:[(0,n.jsx)(er,{value:"hourly",children:"每小时"}),(0,n.jsx)(er,{value:"daily",children:"每天"}),(0,n.jsx)(er,{value:"weekly",children:"每周"})]})]})]}),(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)(eL,{className:"text-xs text-muted-foreground",children:"执行时间"}),(0,n.jsx)(b,{defaultValue:"02:00:00",className:"h-8 border-border bg-input text-xs text-foreground"})]})]}),(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)(ez,{defaultChecked:!0}),(0,n.jsx)(eL,{className:"text-xs text-foreground",children:"启用调度"})]})]}),(0,n.jsxs)("section",{className:"space-y-4",children:[(0,n.jsx)("h3",{className:"text-sm font-medium text-foreground",children:"数据校验"}),(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)(eV,{defaultChecked:!0,id:"check-1"}),(0,n.jsx)(eL,{htmlFor:"check-1",className:"text-xs text-foreground",children:"需求一致性校验"})]}),(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)(eV,{id:"check-2"}),(0,n.jsx)(eL,{htmlFor:"check-2",className:"text-xs text-foreground",children:"数据质量校验"})]}),(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)(eV,{id:"check-3"}),(0,n.jsx)(eL,{htmlFor:"check-3",className:"text-xs text-foreground",children:"新旧表数据明细对比"})]}),(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)(eV,{id:"check-4"}),(0,n.jsx)(eL,{htmlFor:"check-4",className:"text-xs text-foreground",children:"产出时效性校验"})]}),(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)(eV,{id:"check-5"}),(0,n.jsx)(eL,{htmlFor:"check-5",className:"text-xs text-foreground",children:"配置质量校验"})]})]})]})]})}function eY(e){let{label:t,value:s,originalValue:r,onChange:a,readOnly:i}=e,d=null!=s?String(s):"",l=null!=r?String(r):"",o=d!==l&&""!==l;return(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)(eL,{className:"text-xs text-muted-foreground",children:t}),(0,n.jsxs)("div",{className:"relative",children:[(0,n.jsx)(b,{value:d,onChange:e=>!i&&a(e.target.value),readOnly:i,className:m("h-8 border-border bg-input text-xs text-foreground font-mono transition-all",o&&"border-amber-400/50 bg-amber-500/5 pr-8")}),o&&(0,n.jsx)("div",{className:"absolute right-2 top-1/2 -translate-y-1/2 text-amber-500",children:(0,n.jsx)("div",{className:"h-2 w-2 rounded-full bg-amber-500 animate-pulse"})})]}),o&&(0,n.jsxs)("div",{className:"text-[10px] text-amber-500/80 flex items-center gap-1",children:[(0,n.jsx)("span",{children:"原始值:"}),(0,n.jsx)("span",{className:"font-mono bg-amber-500/10 px-1 rounded line-through",children:l})]})]})}function e$(e){let{artifact:t,version:s,content:a,onContentChange:i}=e,d=void 0!==a?a:s.yamlContent||"",l=s.yamlContent||"",o=r.useMemo(()=>eQ(d),[d]),c=r.useMemo(()=>eQ(l),[l]),[m,u]=r.useState(o),x=r.useRef(!1);r.useEffect(()=>{x.current||u(eQ(d)),x.current=!1},[s.id,void 0===a?d:null]);let p=(e,t)=>{x.current=!0;let s=JSON.parse(JSON.stringify(m)),n=e.split("."),r=s;for(let e=0;e<n.length-1;e++)r[n[e]]||(r[n[e]]={}),r=r[n[e]];r[n[n.length-1]]=t,u(s);try{let e="# DTS Configuration\n数据来源:\n  数据源类型: hive\n  参数:\n    机房: ".concat(s.source.region||"default","\n    同步方式: ").concat(s.sync.mode||"table","\n    源数据库名: ").concat(s.source.database||"","\n    源表名: ").concat(s.source.table||"","\n    分区字段列表:\n      - 分区名: ").concat(s.source.partition||"dt","\n        分区类型: string\n\nTarget:\n  目标数据库: ").concat(s.target.database||"","\n  目标表名: ").concat(s.target.table||"","\n  集群: ").concat(s.target.cluster||"","\n  引擎: ").concat(s.target.engine||"","\n");null==i||i(e)}catch(e){console.error("Failed to dump yaml",e)}},h=(e,t)=>e?t.split(".").reduce((e,t)=>e&&e[t],e):"";return t.name.replace("dts_hive2ck_","").replace(/\.(yaml|dts)$/,""),(0,n.jsxs)("div",{className:"space-y-6 p-4",children:[(0,n.jsxs)("div",{className:"flex items-center gap-3 rounded-lg border border-blue-500/30 bg-blue-500/5 p-3",children:[(0,n.jsx)("div",{className:"flex h-10 w-10 items-center justify-center rounded-lg bg-blue-500/20",children:(0,n.jsx)("svg",{className:"h-5 w-5 text-blue-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"})})}),(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"text-sm font-medium text-foreground",children:"DTS 数据集成任务"}),(0,n.jsx)("div",{className:"text-xs text-muted-foreground",children:"Hive → ClickHouse 数据同步"})]}),(0,n.jsx)(el,{className:"ml-auto bg-blue-500/20 text-blue-400",children:"Hive2CK"})]}),(0,n.jsxs)("section",{className:"space-y-4",children:[(0,n.jsxs)("h3",{className:"flex items-center gap-2 text-sm font-medium text-foreground",children:[(0,n.jsx)("span",{className:"flex h-5 w-5 items-center justify-center rounded bg-purple-500/20 text-xs text-purple-400",children:"依"}),"依赖关系 (Dependencies)"]}),(0,n.jsx)("div",{className:"rounded-lg border border-border bg-card/50 p-4",children:(0,n.jsxs)("div",{className:"space-y-3",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsx)("span",{className:"text-xs text-muted-foreground",children:"上游依赖 (Upstream)"}),(0,n.jsx)(el,{variant:"outline",className:"text-[10px] text-muted-foreground",children:"自动解析"})]}),(0,n.jsxs)("div",{className:"flex items-center gap-3 p-3 rounded-md bg-background border border-border/50",children:[(0,n.jsx)("div",{className:"h-8 w-8 rounded bg-amber-500/10 flex items-center justify-center",children:(0,n.jsx)("svg",{className:"h-4 w-4 text-amber-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 10h18M3 14h18m-9-4v8m-7 0h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"})})}),(0,n.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsxs)("span",{className:"text-xs font-mono font-medium text-foreground truncate",children:[h(m,"source.database"),".",h(m,"source.table")]}),(0,n.jsx)(el,{className:"bg-amber-500/10 text-amber-400 text-[10px] h-4 px-1 rounded-sm shadow-none hover:bg-amber-500/20",children:"Source Table"})]}),(0,n.jsxs)("div",{className:"text-[10px] text-muted-foreground mt-0.5",children:["分区: ",h(m,"source.partition")||"dt"]})]}),(0,n.jsxs)("div",{className:"text-xs text-emerald-400 flex items-center gap-1",children:[(0,n.jsx)("div",{className:"h-1.5 w-1.5 rounded-full bg-emerald-400"}),"Ready"]})]})]})})]}),(0,n.jsxs)("section",{className:"space-y-4",children:[(0,n.jsxs)("h3",{className:"flex items-center gap-2 text-sm font-medium text-foreground",children:[(0,n.jsx)("span",{className:"flex h-5 w-5 items-center justify-center rounded bg-amber-500/20 text-xs text-amber-400",children:"源"}),"源端配置 (Hive)"]}),(0,n.jsx)("div",{className:"rounded-lg border border-border bg-card/50 p-4",children:(0,n.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)(eL,{className:"text-xs text-muted-foreground",children:"数据库类型"}),(0,n.jsx)("div",{className:"flex h-8 items-center rounded-md border border-border bg-input px-3",children:(0,n.jsx)(el,{className:"bg-amber-500/10 text-amber-400 text-xs",children:"Hive"})})]}),(0,n.jsx)(eY,{label:"源数据库",value:h(m,"source.database"),originalValue:h(c,"source.database"),onChange:e=>p("source.database",e)}),(0,n.jsx)(eY,{label:"源表名",value:h(m,"source.table"),originalValue:h(c,"source.table"),onChange:e=>p("source.table",e)}),(0,n.jsx)(eY,{label:"机房",value:h(m,"source.region"),originalValue:h(c,"source.region"),onChange:e=>p("source.region",e)}),(0,n.jsx)(eY,{label:"分区字段",value:h(m,"source.partition"),originalValue:h(c,"source.partition"),onChange:e=>p("source.partition",e)})]})})]}),(0,n.jsxs)("section",{className:"space-y-4",children:[(0,n.jsxs)("h3",{className:"flex items-center gap-2 text-sm font-medium text-foreground",children:[(0,n.jsx)("span",{className:"flex h-5 w-5 items-center justify-center rounded bg-blue-500/20 text-xs text-blue-400",children:"目"}),"目标端配置 (ClickHouse)"]}),(0,n.jsx)("div",{className:"rounded-lg border border-border bg-card/50 p-4",children:(0,n.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)(eL,{className:"text-xs text-muted-foreground",children:"数据库类型"}),(0,n.jsx)("div",{className:"flex h-8 items-center rounded-md border border-border bg-input px-3",children:(0,n.jsx)(el,{className:"bg-blue-500/10 text-blue-400 text-xs",children:"ClickHouse"})})]}),(0,n.jsx)(eY,{label:"目标数据库",value:h(m,"target.database"),originalValue:h(c,"target.database"),onChange:e=>p("target.database",e)}),(0,n.jsx)(eY,{label:"目标表名",value:h(m,"target.table"),originalValue:h(c,"target.table"),onChange:e=>p("target.table",e)}),(0,n.jsx)(eY,{label:"集群名称",value:h(m,"target.cluster"),originalValue:h(c,"target.cluster"),onChange:e=>p("target.cluster",e)}),(0,n.jsx)(eY,{label:"表引擎",value:h(m,"target.engine"),originalValue:h(c,"target.engine"),onChange:e=>p("target.engine",e)})]})})]}),(0,n.jsxs)("section",{className:"space-y-4",children:[(0,n.jsx)("h3",{className:"text-sm font-medium text-foreground",children:"字段映射"}),(0,n.jsx)("div",{className:"rounded-md border border-border bg-card",children:(0,n.jsxs)("table",{className:"w-full text-xs",children:[(0,n.jsx)("thead",{className:"bg-ide-panel-header",children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("th",{className:"px-3 py-2 text-left font-medium text-foreground",children:"源字段"}),(0,n.jsx)("th",{className:"px-3 py-2 text-center font-medium text-muted-foreground",children:"→"}),(0,n.jsx)("th",{className:"px-3 py-2 text-left font-medium text-foreground",children:"目标字段"}),(0,n.jsx)("th",{className:"px-3 py-2 text-left font-medium text-foreground",children:"类型"})]})}),(0,n.jsx)("tbody",{className:"text-foreground",children:m.fields&&m.fields.length>0?m.fields.map((e,t)=>(0,n.jsxs)("tr",{className:"border-t border-border",children:[(0,n.jsx)("td",{className:"px-3 py-2 font-mono text-amber-400",children:e.sourceName}),(0,n.jsx)("td",{className:"px-3 py-2 text-center text-muted-foreground",children:"→"}),(0,n.jsx)("td",{className:"px-3 py-2 font-mono text-blue-400",children:e.targetName||e.sourceName}),(0,n.jsx)("td",{className:"px-3 py-2 text-emerald-400",children:e.type})]},t)):(0,n.jsx)("tr",{className:"border-t border-border",children:(0,n.jsx)("td",{colSpan:4,className:"px-3 py-4 text-center text-muted-foreground",children:"暂无字段映射信息"})})})]})})]}),(0,n.jsxs)("section",{className:"space-y-4",children:[(0,n.jsx)("h3",{className:"text-sm font-medium text-foreground",children:"同步配置"}),(0,n.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,n.jsx)(eY,{label:"同步方式",value:h(m,"sync.mode"),originalValue:h(c,"sync.mode"),onChange:e=>p("sync.mode",e)}),(0,n.jsx)(eY,{label:"批量大小",value:h(m,"sync.batchSize"),originalValue:h(c,"sync.batchSize"),onChange:e=>p("sync.batchSize",e)}),(0,n.jsx)(eY,{label:"并行度",value:h(m,"sync.parallelism"),originalValue:h(c,"sync.parallelism"),onChange:e=>p("sync.parallelism",e)})]})]})]})}function eQ(e){let t={source:{},target:{},sync:{},fields:[]};return e.split("\n").forEach(e=>{let s=e.trim();!(!s||s.startsWith("#"))&&(s.includes("源数据库名:")?t.source.database=s.split(":")[1].trim():s.includes("源表名:")?t.source.table=s.split(":")[1].trim():s.includes("机房:")?t.source.region=s.split(":")[1].trim():s.includes("target_database:")||s.includes("目标数据库:")?t.target.database=s.split(":")[1].trim():s.includes("target_table:")||s.includes("目标表名:")?t.target.table=s.split(":")[1].trim():s.includes("cluster:")||s.includes("集群:")?t.target.cluster=s.split(":")[1].trim():s.includes("engine:")||s.includes("引擎:")?t.target.engine=s.split(":")[1].trim():s.includes("分区名:")?t.source.partition=s.split(":")[1].trim():s.includes("同步方式:")&&(t.sync.mode=s.split(":")[1].trim()))}),t}function eX(e){let{artifact:t,version:s}=e;return(0,n.jsxs)("div",{className:"space-y-6 p-4",children:[(0,n.jsxs)("section",{className:"space-y-4",children:[(0,n.jsx)("h3",{className:"text-sm font-medium text-foreground",children:"表信息"}),(0,n.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)(eL,{className:"text-xs text-muted-foreground",children:"表名"}),(0,n.jsx)(b,{value:t.name,readOnly:!0,className:"h-8 border-border bg-input text-xs text-foreground"})]}),(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)(eL,{className:"text-xs text-muted-foreground",children:"存储格式"}),(0,n.jsxs)(ee,{defaultValue:"orc",children:[(0,n.jsx)(es,{className:"h-8 border-border bg-input text-xs text-foreground",children:(0,n.jsx)(et,{})}),(0,n.jsxs)(en,{className:"border-border bg-popover",children:[(0,n.jsx)(er,{value:"orc",children:"ORC"}),(0,n.jsx)(er,{value:"parquet",children:"Parquet"}),(0,n.jsx)(er,{value:"text",children:"Text"})]})]})]})]})]}),(0,n.jsxs)("section",{className:"space-y-4",children:[(0,n.jsx)("h3",{className:"text-sm font-medium text-foreground",children:"字段列表"}),(0,n.jsx)("div",{className:"rounded-md border border-border bg-card",children:(0,n.jsxs)("table",{className:"w-full text-xs",children:[(0,n.jsx)("thead",{className:"bg-ide-panel-header",children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("th",{className:"px-3 py-2 text-left font-medium text-foreground",children:"字段名"}),(0,n.jsx)("th",{className:"px-3 py-2 text-left font-medium text-foreground",children:"类型"}),(0,n.jsx)("th",{className:"px-3 py-2 text-left font-medium text-foreground",children:"注释"})]})}),(0,n.jsxs)("tbody",{className:"text-foreground",children:[(0,n.jsxs)("tr",{className:"border-t border-border",children:[(0,n.jsx)("td",{className:"px-3 py-2 font-mono text-blue-400",children:"transaction_id"}),(0,n.jsx)("td",{className:"px-3 py-2 text-emerald-400",children:"STRING"}),(0,n.jsx)("td",{className:"px-3 py-2 text-muted-foreground",children:"交易ID"})]}),(0,n.jsxs)("tr",{className:"border-t border-border",children:[(0,n.jsx)("td",{className:"px-3 py-2 font-mono text-blue-400",children:"user_id"}),(0,n.jsx)("td",{className:"px-3 py-2 text-emerald-400",children:"STRING"}),(0,n.jsx)("td",{className:"px-3 py-2 text-muted-foreground",children:"用户ID"})]}),(0,n.jsxs)("tr",{className:"border-t border-border",children:[(0,n.jsx)("td",{className:"px-3 py-2 font-mono text-blue-400",children:"gift_amount"}),(0,n.jsx)("td",{className:"px-3 py-2 text-emerald-400",children:"DECIMAL(18,2)"}),(0,n.jsx)("td",{className:"px-3 py-2 text-muted-foreground",children:"礼物金额"})]}),(0,n.jsxs)("tr",{className:"border-t border-border",children:[(0,n.jsx)("td",{className:"px-3 py-2 font-mono text-blue-400",children:"gift_time"}),(0,n.jsx)("td",{className:"px-3 py-2 text-emerald-400",children:"TIMESTAMP"}),(0,n.jsx)("td",{className:"px-3 py-2 text-muted-foreground",children:"送礼时间"})]})]})]})})]})]})}function eK(e){var t,s,a,i;let{artifact:d,version:l,content:o,onContentChange:c}=e,u=void 0!==o?o:l.yamlContent||"",[x,p]=r.useState(()=>eJ(u));r.useEffect(()=>{p(eJ(l.yamlContent||""))},[l.id]);let h=e=>{let t;let s={...x,...e};p(s);let n=(t="---\n",s.description&&(t+="description: ".concat(s.description,"\n")),s.queue&&(t+="queue: ".concat(s.queue,"\n")),s.priority&&(t+="priority: ".concat(s.priority,"\n")),s.frequency&&(t+="frequency: ".concat(s.frequency,"\n")),s.cronExpression&&(t+="cronExpression: ".concat(s.cronExpression,"\n")),s.dependencies&&s.dependencies.length>0&&(t+="\ndependencies:\n",s.dependencies.forEach(e=>{t+="  - parentTaskId: ".concat(e.parentTaskId,"\n")+"    branchIds: null\n    dependNonExistParents: false\n"+"    offsetFrequency: ".concat(e.offsetFrequency||"daily","\n")+"    offsetsType: set\n",Array.isArray(e.offsets)&&e.offsets.length>0?(t+="    offsets:\n",e.offsets.forEach(e=>t+="      - ".concat(e,"\n"))):t+="    offsets:\n      - 0\n"})),t+="---\n");null==c||c(n)};return(0,n.jsxs)("div",{className:"space-y-8 p-6 max-w-5xl mx-auto",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h2",{className:"text-lg font-medium tracking-tight",children:"调度属性"}),(0,n.jsx)("p",{className:"text-sm text-muted-foreground",children:"配置任务的调度周期、依赖关系及运行参数"})]}),(0,n.jsx)("div",{className:"flex items-center gap-2",children:(0,n.jsxs)(el,{variant:"outline",className:"gap-1",children:[(0,n.jsx)("span",{className:"h-2 w-2 rounded-full bg-green-500"}),"调度开启"]})})]}),(0,n.jsxs)("div",{className:"grid gap-6 rounded-lg border bg-card p-6 shadow-sm",children:[(0,n.jsxs)("div",{className:"grid grid-cols-2 gap-8",children:[(0,n.jsxs)("div",{className:"space-y-6",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsx)(eL,{className:"w-24 text-muted-foreground",children:"调度状态"}),(0,n.jsx)("div",{className:"flex-1 flex items-center gap-4",children:(0,n.jsx)("div",{className:"flex items-center gap-2",children:(0,n.jsxs)(eB,{defaultValue:"open",className:"flex gap-4",children:[(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)(eU,{value:"open",id:"r1"}),(0,n.jsx)(eL,{htmlFor:"r1",children:"开启"})]}),(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)(eU,{value:"pause",id:"r2"}),(0,n.jsx)(eL,{htmlFor:"r2",children:"暂停"})]})]})})})]}),(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsx)(eL,{className:"w-24 text-muted-foreground",children:"调度类型"}),(0,n.jsx)("div",{className:"flex-1",children:(0,n.jsxs)(eB,{defaultValue:"period",className:"flex gap-4",children:[(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)(eU,{value:"period",id:"t1"}),(0,n.jsx)(eL,{htmlFor:"t1",children:"周期调度"})]}),(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)(eU,{value:"manual",id:"t2"}),(0,n.jsx)(eL,{htmlFor:"t2",children:"手动调度"})]})]})})]}),(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsx)(eL,{className:"w-24 text-muted-foreground",children:"生效日期"}),(0,n.jsxs)("div",{className:"flex-1 flex gap-2 items-center",children:[(0,n.jsxs)(v,{variant:"outline",className:m("w-[180px] justify-start text-left font-normal h-8"),children:[(0,n.jsx)(eW.Z,{className:"mr-2 h-4 w-4"}),"1970-01-01"]}),(0,n.jsx)("span",{className:"text-muted-foreground",children:"-"}),(0,n.jsxs)(v,{variant:"outline",className:m("w-[180px] justify-start text-left font-normal h-8"),children:[(0,n.jsx)(eW.Z,{className:"mr-2 h-4 w-4"}),"9999-12-31"]})]})]}),(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsx)(eL,{className:"w-24 text-muted-foreground",children:"执行频率"}),(0,n.jsx)("div",{className:"flex-1",children:(0,n.jsx)(eB,{value:x.frequency||"daily",onValueChange:e=>{h({frequency:e})},className:"flex gap-3",children:["minute","hourly","daily","weekly","monthly"].map(e=>(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)(eU,{value:e,id:"freq-".concat(e)}),(0,n.jsx)(eL,{htmlFor:"freq-".concat(e),className:"capitalize",children:e})]},e))})})]}),(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsx)(eL,{className:"w-24 text-muted-foreground",children:"执行时间"}),(0,n.jsxs)("div",{className:"flex-1 flex items-center gap-2",children:[(0,n.jsx)(b,{value:(null===(a=x.cronExpression)||void 0===a?void 0:null===(s=a.replace(/0 0 \* \* \*/,"00:00"))||void 0===s?void 0:null===(t=s.replace(/0 2 \* \* \*/,"02:00"))||void 0===t?void 0:t.replace(/0 3 \* \* \*/,"03:00"))||"00:00",onChange:e=>{let t=e.target.value;h({cronExpression:"0 ".concat(parseInt(t.split(":")[1]||"0")," ").concat(parseInt(t.split(":")[0]||"0")," * * *")})},className:"w-32 h-8 font-mono"}),(0,n.jsxs)("span",{className:"text-xs text-muted-foreground",children:["Cron: ",x.cronExpression||"0 0 * * *"]})]})]})]}),(0,n.jsxs)("div",{className:"space-y-6",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsx)(eL,{className:"w-24 text-muted-foreground",children:"优先级"}),(0,n.jsx)("div",{className:"flex-1",children:(0,n.jsxs)(ee,{value:x.priority||"normal",onValueChange:e=>{h({priority:e})},children:[(0,n.jsx)(es,{className:"h-8 w-40",children:(0,n.jsx)(et,{})}),(0,n.jsxs)(en,{children:[(0,n.jsx)(er,{value:"normal",children:"Normal"}),(0,n.jsx)(er,{value:"high",children:"High"}),(0,n.jsx)(er,{value:"super_high",children:"Super High"})]})]})})]}),(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsx)(eL,{className:"w-24 text-muted-foreground",children:"失败重试"}),(0,n.jsxs)("div",{className:"flex-1 flex items-center gap-4",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)(eV,{id:"retry-fail",defaultChecked:!0}),(0,n.jsx)(eL,{htmlFor:"retry-fail",children:"失败"})]}),(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)(eV,{id:"retry-timeout"}),(0,n.jsx)(eL,{htmlFor:"retry-timeout",children:"超时"})]})]})]}),(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsx)(eL,{className:"w-24 text-muted-foreground",children:"重试次数"}),(0,n.jsxs)("div",{className:"flex-1 flex items-center gap-2",children:[(0,n.jsx)(b,{type:"number",defaultValue:"3",className:"w-20 h-8"}),(0,n.jsx)("span",{className:"text-xs text-muted-foreground",children:"次"})]})]}),(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsx)(eL,{className:"w-24 text-muted-foreground",children:"重试间隔"}),(0,n.jsxs)("div",{className:"flex-1 flex items-center gap-2",children:[(0,n.jsxs)(ee,{defaultValue:"5",onValueChange:e=>{h({retryInterval:e})},children:[(0,n.jsx)(es,{className:"h-8 w-20",children:(0,n.jsx)(et,{})}),(0,n.jsxs)(en,{children:[(0,n.jsx)(er,{value:"1",children:"1"}),(0,n.jsx)(er,{value:"5",children:"5"}),(0,n.jsx)(er,{value:"10",children:"10"})]})]}),(0,n.jsx)("span",{className:"text-xs text-muted-foreground",children:"分钟"})]})]}),(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsx)(eL,{className:"w-24 text-muted-foreground",children:"超时时间"}),(0,n.jsxs)("div",{className:"flex-1 flex items-center gap-2",children:[(0,n.jsx)(b,{type:"number",defaultValue:"1",className:"w-20 h-8"}),(0,n.jsx)("span",{className:"text-xs text-muted-foreground",children:"小时"})]})]})]})]}),(0,n.jsxs)("div",{className:"grid grid-cols-3 gap-4 pt-4 border-t mt-2",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsx)(eL,{className:"text-muted-foreground",children:"分时队列"}),(0,n.jsx)(ez,{})]}),(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsx)(eL,{className:"text-muted-foreground",children:"空跑设置"}),(0,n.jsx)(ez,{})]}),(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsx)(eL,{className:"text-muted-foreground",children:"最大并发控制"}),(0,n.jsx)(ez,{})]})]})]}),(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsx)("h3",{className:"text-lg font-medium tracking-tight",children:"依赖关系"}),(0,n.jsxs)(v,{size:"sm",variant:"outline",className:"h-8 gap-1",children:[(0,n.jsx)(eF.Z,{className:"h-3.5 w-3.5"}),"手动添加"]})]}),(0,n.jsx)("div",{className:"rounded-md border bg-card",children:(0,n.jsxs)("table",{className:"w-full text-sm",children:[(0,n.jsx)("thead",{className:"bg-muted/50 text-xs",children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("th",{className:"px-4 py-3 text-left font-medium text-muted-foreground",children:"任务 ID"}),(0,n.jsx)("th",{className:"px-4 py-3 text-left font-medium text-muted-foreground",children:"机房"}),(0,n.jsx)("th",{className:"px-4 py-3 text-left font-medium text-muted-foreground",children:"依赖模式"}),(0,n.jsx)("th",{className:"px-4 py-3 text-left font-medium text-muted-foreground",children:"偏移量"}),(0,n.jsx)("th",{className:"px-4 py-3 text-right font-medium text-muted-foreground",children:"操作"})]})}),(0,n.jsxs)("tbody",{children:[null===(i=x.dependencies)||void 0===i?void 0:i.map((e,t)=>(0,n.jsxs)("tr",{className:"border-t",children:[(0,n.jsx)("td",{className:"px-4 py-3 font-mono",children:e.parentTaskId||"Unknown"}),(0,n.jsx)("td",{className:"px-4 py-3",children:(0,n.jsx)(el,{variant:"secondary",className:"font-mono text-xs",children:"default"})}),(0,n.jsx)("td",{className:"px-4 py-3 text-muted-foreground",children:e.offsetFrequency||"daily"}),(0,n.jsx)("td",{className:"px-4 py-3 font-mono text-muted-foreground",children:Array.isArray(e.offsets)?e.offsets.join(", "):e.offsets||"0"}),(0,n.jsx)("td",{className:"px-4 py-3 text-right",children:(0,n.jsx)(v,{variant:"ghost",size:"sm",className:"h-6 text-blue-500 hover:text-blue-600",children:"配置"})})]},t)),(!x.dependencies||0===x.dependencies.length)&&(0,n.jsx)("tr",{children:(0,n.jsx)("td",{colSpan:5,className:"px-4 py-8 text-center text-muted-foreground",children:"暂无依赖配置"})})]})]})})]})]})}function eJ(e){let t={dependencies:[]},s=e.split("\n"),n=!1,r=null;return s.forEach(e=>{let s=e.trim();if(!s||s.startsWith("---")||s.startsWith("#"))return;if(s.startsWith("dependencies:")){n=!0;return}if(n){s.startsWith("-")&&(r&&t.dependencies.push(r),r={});let e=s.replace(/^- /,"").match(/^([a-zA-Z0-9_]+):\s*(.*)$/);if(e&&r){let t=e[1],s=e[2];if("null"===s&&(s=null),s&&s.startsWith("[")&&s.endsWith("]"))try{s=JSON.parse(s)}catch(e){}"offsets"===t&&""===s?r[t]=[]:r[t]=s}else if(s.startsWith("-")&&!s.includes(":")&&(null==r?void 0:r.offsets)){let e=s.replace("- ","");Array.isArray(r.offsets)?r.offsets.push(e):r.offsets=[e]}else"- 0"===s&&r&&(r.offsets||(r.offsets=[]),r.offsets.push("0"));return}let a=s.match(/^([a-zA-Z0-9_]+):\s*(.*)$/);if(a){let e=a[1],s=a[2];s.includes("#")&&(s=s.split("#")[0].trim()),t[e]=s}}),r&&t.dependencies.push(r),t}function e0(e){let{artifact:t,version:s}=e;return(0,n.jsxs)("div",{className:"space-y-6 p-4",children:[(0,n.jsxs)("section",{className:"space-y-4",children:[(0,n.jsx)("h3",{className:"text-sm font-medium text-foreground",children:"测试报告"}),(0,n.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)(eL,{className:"text-xs text-muted-foreground",children:"报告名称"}),(0,n.jsx)(b,{value:t.name,readOnly:!0,className:"h-8 border-border bg-input text-xs text-foreground"})]}),(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)(eL,{className:"text-xs text-muted-foreground",children:"生成时间"}),(0,n.jsx)(b,{value:s.createdAt,readOnly:!0,className:"h-8 border-border bg-input text-xs text-foreground"})]})]})]}),(0,n.jsxs)("section",{className:"space-y-4",children:[(0,n.jsx)("h3",{className:"text-sm font-medium text-foreground",children:"测试结果"}),(0,n.jsx)("div",{className:"rounded-md border border-border bg-card",children:(0,n.jsxs)("table",{className:"w-full text-xs",children:[(0,n.jsx)("thead",{className:"bg-ide-panel-header",children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("th",{className:"px-3 py-2 text-left font-medium text-foreground",children:"测试项"}),(0,n.jsx)("th",{className:"px-3 py-2 text-left font-medium text-foreground",children:"结果"}),(0,n.jsx)("th",{className:"px-3 py-2 text-left font-medium text-foreground",children:"说明"})]})}),(0,n.jsxs)("tbody",{className:"text-foreground",children:[(0,n.jsxs)("tr",{className:"border-t border-border",children:[(0,n.jsx)("td",{className:"px-3 py-2",children:"语法检查"}),(0,n.jsx)("td",{className:"px-3 py-2",children:(0,n.jsx)(el,{className:"bg-green-500/20 text-green-400",children:"PASS"})}),(0,n.jsx)("td",{className:"px-3 py-2 text-muted-foreground",children:"SQL语法正确"})]}),(0,n.jsxs)("tr",{className:"border-t border-border",children:[(0,n.jsx)("td",{className:"px-3 py-2",children:"数据一致性"}),(0,n.jsx)("td",{className:"px-3 py-2",children:(0,n.jsx)(el,{className:"bg-green-500/20 text-green-400",children:"PASS"})}),(0,n.jsx)("td",{className:"px-3 py-2 text-muted-foreground",children:"数据对比一致"})]}),(0,n.jsxs)("tr",{className:"border-t border-border",children:[(0,n.jsx)("td",{className:"px-3 py-2",children:"性能测试"}),(0,n.jsx)("td",{className:"px-3 py-2",children:(0,n.jsx)(el,{className:"bg-green-500/20 text-green-400",children:"PASS"})}),(0,n.jsxs)("td",{className:"px-3 py-2 text-muted-foreground",children:["执行时间 ","<"," 5min"]})]})]})]})})]}),(0,n.jsxs)("section",{className:"space-y-4",children:[(0,n.jsx)("h3",{className:"text-sm font-medium text-foreground",children:"数据统计"}),(0,n.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,n.jsxs)("div",{className:"rounded-md border border-border bg-card p-3 text-center",children:[(0,n.jsx)("div",{className:"text-2xl font-bold text-foreground",children:"1,234,567"}),(0,n.jsx)("div",{className:"text-xs text-muted-foreground",children:"总记录数"})]}),(0,n.jsxs)("div",{className:"rounded-md border border-border bg-card p-3 text-center",children:[(0,n.jsx)("div",{className:"text-2xl font-bold text-green-400",children:"0.01%"}),(0,n.jsx)("div",{className:"text-xs text-muted-foreground",children:"空值率"})]}),(0,n.jsxs)("div",{className:"rounded-md border border-border bg-card p-3 text-center",children:[(0,n.jsx)("div",{className:"text-2xl font-bold text-green-400",children:"0%"}),(0,n.jsx)("div",{className:"text-xs text-muted-foreground",children:"重复率"})]})]})]})]})}var e2=s(9554),e1=s(3720),e5=s(3807);function e3(e){let{oldContent:t,newContent:s,oldTitle:a="旧版本",newTitle:i="新版本",defaultMode:d="inline"}=e,[l,o]=(0,r.useState)(d),c=(0,r.useMemo)(()=>(function(e,t){let s=e.split("\n"),n=t.split("\n"),r=[],a=0,i=0,d=1,l=1;for(;a<s.length||i<n.length;)if(a>=s.length)r.push({type:"add",content:n[i],newLineNum:l++}),i++;else if(i>=n.length)r.push({type:"remove",content:s[a],oldLineNum:d++}),a++;else if(s[a]===n[i])r.push({type:"unchanged",content:s[a],oldLineNum:d++,newLineNum:l++}),a++,i++;else{let e=-1,t=-1;for(let t=i+1;t<Math.min(i+5,n.length);t++)if(s[a]===n[t]){e=t;break}for(let e=a+1;e<Math.min(a+5,s.length);e++)if(n[i]===s[e]){t=e;break}if(-1!==e&&(-1===t||e-i<=t-a))for(;i<e;)r.push({type:"add",content:n[i],newLineNum:l++}),i++;else if(-1!==t)for(;a<t;)r.push({type:"remove",content:s[a],oldLineNum:d++}),a++;else r.push({type:"remove",content:s[a],oldLineNum:d++}),a++,r.push({type:"add",content:n[i],newLineNum:l++}),i++}return r})(t,s),[t,s]),u=(0,r.useMemo)(()=>(function(e){let t=[],s=0;for(;s<e.length;){let n=e[s];if("unchanged"===n.type)t.push({left:{lineNum:n.oldLineNum,content:n.content,type:"unchanged"},right:{lineNum:n.newLineNum,content:n.content,type:"unchanged"}}),s++;else if("remove"===n.type){let n=[],r=[];for(;s<e.length&&"remove"===e[s].type;)n.push(e[s]),s++;for(;s<e.length&&"add"===e[s].type;)r.push(e[s]),s++;let a=Math.max(n.length,r.length);for(let e=0;e<a;e++)t.push({left:e<n.length?{lineNum:n[e].oldLineNum,content:n[e].content,type:"remove"}:{content:"",type:"empty"},right:e<r.length?{lineNum:r[e].newLineNum,content:r[e].content,type:"add"}:{content:"",type:"empty"}})}else"add"===n.type&&(t.push({left:{content:"",type:"empty"},right:{lineNum:n.newLineNum,content:n.content,type:"add"}}),s++)}return t})(c),[c]),x=(0,r.useMemo)(()=>({additions:c.filter(e=>"add"===e.type).length,deletions:c.filter(e=>"remove"===e.type).length}),[c]);return(0,n.jsxs)("div",{className:"flex h-full flex-col bg-background",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between border-b border-border bg-ide-panel-header px-4 py-2",children:[(0,n.jsxs)("div",{className:"flex items-center gap-3",children:[(0,n.jsx)("span",{className:"text-sm font-medium text-foreground",children:"差异对比"}),(0,n.jsxs)(el,{className:"bg-green-500/20 text-green-400 gap-1",children:[(0,n.jsx)(eF.Z,{className:"h-3 w-3"}),x.additions]}),(0,n.jsxs)(el,{className:"bg-red-500/20 text-red-400 gap-1",children:[(0,n.jsx)(e2.Z,{className:"h-3 w-3"}),x.deletions]})]}),(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsxs)("div",{className:"flex items-center gap-1 rounded-md border border-border bg-background p-0.5",children:[(0,n.jsxs)(v,{variant:"inline"===l?"secondary":"ghost",size:"sm",className:m("h-7 px-2 gap-1.5","inline"===l&&"bg-muted"),onClick:()=>o("inline"),children:[(0,n.jsx)(e1.Z,{className:"h-3.5 w-3.5"}),(0,n.jsx)("span",{className:"text-xs",children:"行内"})]}),(0,n.jsxs)(v,{variant:"side-by-side"===l?"secondary":"ghost",size:"sm",className:m("h-7 px-2 gap-1.5","side-by-side"===l&&"bg-muted"),onClick:()=>o("side-by-side"),children:[(0,n.jsx)(e5.Z,{className:"h-3.5 w-3.5"}),(0,n.jsx)("span",{className:"text-xs",children:"双列"})]})]}),(0,n.jsxs)("div",{className:"flex items-center gap-2 text-xs text-muted-foreground ml-2",children:[(0,n.jsx)("span",{children:a}),(0,n.jsx)("span",{children:"→"}),(0,n.jsx)("span",{children:i})]})]})]}),(0,n.jsx)(N,{className:"flex-1",children:"inline"===l?(0,n.jsx)("div",{className:"font-mono text-xs",children:c.map((e,t)=>(0,n.jsxs)("div",{className:m("flex border-b border-border/50","add"===e.type&&"bg-green-500/10","remove"===e.type&&"bg-red-500/10","unchanged"===e.type&&"bg-transparent"),children:[(0,n.jsxs)("div",{className:"flex w-20 shrink-0 select-none border-r border-border/50 text-muted-foreground",children:[(0,n.jsx)("span",{className:m("w-10 px-2 py-0.5 text-right","remove"===e.type&&"bg-red-500/20"),children:e.oldLineNum||""}),(0,n.jsx)("span",{className:m("w-10 px-2 py-0.5 text-right","add"===e.type&&"bg-green-500/20"),children:e.newLineNum||""})]}),(0,n.jsxs)("div",{className:m("w-6 shrink-0 px-1 py-0.5 text-center","add"===e.type&&"text-green-400","remove"===e.type&&"text-red-400","unchanged"===e.type&&"text-muted-foreground"),children:["add"===e.type&&(0,n.jsx)(eF.Z,{className:"inline h-3 w-3"}),"remove"===e.type&&(0,n.jsx)(e2.Z,{className:"inline h-3 w-3"}),"unchanged"===e.type&&" "]}),(0,n.jsx)("div",{className:m("flex-1 whitespace-pre px-2 py-0.5","add"===e.type&&"text-green-300","remove"===e.type&&"text-red-300","unchanged"===e.type&&"text-foreground"),children:e.content||" "})]},t))}):(0,n.jsxs)("div",{className:"font-mono text-xs flex",children:[(0,n.jsxs)("div",{className:"flex-1 border-r border-border",children:[(0,n.jsxs)("div",{className:"sticky top-0 z-10 bg-ide-panel-header border-b border-border px-3 py-1.5 text-xs font-medium text-muted-foreground",children:[a," (旧)"]}),u.map((e,t)=>(0,n.jsxs)("div",{className:m("flex border-b border-border/50","remove"===e.left.type&&"bg-red-500/10","empty"===e.left.type&&"bg-muted/30","unchanged"===e.left.type&&"bg-transparent"),children:[(0,n.jsx)("div",{className:m("w-10 shrink-0 select-none border-r border-border/50 px-2 py-0.5 text-right text-muted-foreground","remove"===e.left.type&&"bg-red-500/20"),children:e.left.lineNum||""}),(0,n.jsx)("div",{className:m("w-6 shrink-0 px-1 py-0.5 text-center","remove"===e.left.type&&"text-red-400","unchanged"===e.left.type&&"text-muted-foreground"),children:"remove"===e.left.type&&(0,n.jsx)(e2.Z,{className:"inline h-3 w-3"})}),(0,n.jsx)("div",{className:m("flex-1 whitespace-pre px-2 py-0.5 overflow-hidden","remove"===e.left.type&&"text-red-300","empty"===e.left.type&&"text-muted-foreground/30","unchanged"===e.left.type&&"text-foreground"),children:e.left.content||" "})]},"left-".concat(t)))]}),(0,n.jsxs)("div",{className:"flex-1",children:[(0,n.jsxs)("div",{className:"sticky top-0 z-10 bg-ide-panel-header border-b border-border px-3 py-1.5 text-xs font-medium text-muted-foreground",children:[i," (新)"]}),u.map((e,t)=>(0,n.jsxs)("div",{className:m("flex border-b border-border/50","add"===e.right.type&&"bg-green-500/10","empty"===e.right.type&&"bg-muted/30","unchanged"===e.right.type&&"bg-transparent"),children:[(0,n.jsx)("div",{className:m("w-10 shrink-0 select-none border-r border-border/50 px-2 py-0.5 text-right text-muted-foreground","add"===e.right.type&&"bg-green-500/20"),children:e.right.lineNum||""}),(0,n.jsx)("div",{className:m("w-6 shrink-0 px-1 py-0.5 text-center","add"===e.right.type&&"text-green-400","unchanged"===e.right.type&&"text-muted-foreground"),children:"add"===e.right.type&&(0,n.jsx)(eF.Z,{className:"inline h-3 w-3"})}),(0,n.jsx)("div",{className:m("flex-1 whitespace-pre px-2 py-0.5 overflow-hidden","add"===e.right.type&&"text-green-300","empty"===e.right.type&&"text-muted-foreground/30","unchanged"===e.right.type&&"text-foreground"),children:e.right.content||" "})]},"right-".concat(t)))]})]})})]})}function e4(e){let{content:t,onApprove:s}=e;return(0,n.jsx)("div",{className:"flex h-full flex-col",children:(0,n.jsx)(N,{className:"flex-1",children:(0,n.jsx)("div",{className:"p-6 max-w-4xl mx-auto",children:(0,n.jsx)("div",{className:"prose prose-invert prose-sm max-w-none",children:function(e){let t=e.split("\n"),s=[],r=!1,a=[],i="",d=!1,l=[],o=e=>{let t=e;return t=(t=(t=t.replace(/\*\*(.*?)\*\*|__(.*?)__/g,"<strong>$1$2</strong>")).replace(/`([^`]+)`/g,'<code class="bg-muted px-1 py-0.5 rounded text-xs font-mono text-cyan-400">$1</code>')).replace(/\[([^\]]+)\]\(([^)]+)\)/g,'<a href="$2" class="text-primary hover:underline">$1</a>'),(0,n.jsx)("span",{dangerouslySetInnerHTML:{__html:t}})};for(let e=0;e<t.length;e++){let m=t[e];if(m.startsWith("```")){r?(s.push((0,n.jsxs)("div",{className:"my-3 rounded-lg bg-muted/50 border border-border overflow-hidden",children:[i&&(0,n.jsx)("div",{className:"px-3 py-1 bg-muted border-b border-border text-[10px] text-muted-foreground",children:i}),(0,n.jsx)("pre",{className:"p-3 overflow-x-auto",children:(0,n.jsx)("code",{className:"text-xs font-mono text-foreground",children:a.join("\n")})})]},e)),a=[],i="",r=!1):(r=!0,i=m.slice(3).trim());continue}if(r){a.push(m);continue}if(m.startsWith("|")&&m.endsWith("|")){if(d||(d=!0,l=[]),m.includes("---"))continue;let r=m.split("|").filter(e=>""!==e.trim());if(l.push(r.map(e=>e.trim())),e===t.length-1||!t[e+1].startsWith("|")){var c;s.push((0,n.jsx)("div",{className:"my-3 overflow-x-auto",children:(0,n.jsxs)("table",{className:"w-full border-collapse text-xs",children:[(0,n.jsx)("thead",{children:(0,n.jsx)("tr",{className:"border-b border-border bg-muted/50",children:null===(c=l[0])||void 0===c?void 0:c.map((e,t)=>(0,n.jsx)("th",{className:"px-3 py-2 text-left font-medium text-foreground",children:o(e)},t))})}),(0,n.jsx)("tbody",{children:l.slice(1).map((e,t)=>(0,n.jsx)("tr",{className:"border-b border-border/50 hover:bg-muted/30",children:e.map((e,t)=>(0,n.jsx)("td",{className:"px-3 py-2 text-muted-foreground",children:o(e)},t))},t))})]})},e)),d=!1,l=[]}continue}if(""===m.trim()){s.push((0,n.jsx)("div",{className:"h-3"},e));continue}if(m.startsWith("# ")){s.push((0,n.jsx)("h1",{className:"text-xl font-bold text-foreground mt-6 mb-3 pb-2 border-b border-border",children:o(m.slice(2))},e));continue}if(m.startsWith("## ")){s.push((0,n.jsx)("h2",{className:"text-lg font-semibold text-foreground mt-5 mb-2",children:o(m.slice(3))},e));continue}if(m.startsWith("### ")){s.push((0,n.jsx)("h3",{className:"text-base font-medium text-foreground mt-4 mb-2",children:o(m.slice(4))},e));continue}if(m.startsWith("- ")){s.push((0,n.jsxs)("div",{className:"flex gap-2 text-sm text-muted-foreground pl-2",children:[(0,n.jsx)("span",{className:"text-primary",children:"•"}),(0,n.jsx)("span",{children:o(m.slice(2))})]},e));continue}if(m.startsWith("- [ ] ")){s.push((0,n.jsxs)("div",{className:"flex items-center gap-2 text-sm text-muted-foreground pl-2",children:[(0,n.jsx)("span",{className:"w-4 h-4 border border-border rounded flex items-center justify-center text-[10px]"}),(0,n.jsx)("span",{children:o(m.slice(6))})]},e));continue}if(m.startsWith("- [x] ")||m.startsWith("- [X] ")){s.push((0,n.jsxs)("div",{className:"flex items-center gap-2 text-sm text-muted-foreground pl-2",children:[(0,n.jsx)("span",{className:"w-4 h-4 bg-primary border border-primary rounded flex items-center justify-center text-[10px] text-primary-foreground",children:"✓"}),(0,n.jsx)("span",{className:"line-through opacity-60",children:o(m.slice(6))})]},e));continue}s.push((0,n.jsx)("p",{className:"text-sm text-muted-foreground leading-relaxed",children:o(m)},e))}return s}(t)})})})})}function e6(e){let{content:t,onChange:s}=e;return(0,n.jsxs)("div",{className:"h-full flex flex-col",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2 border-b border-border bg-muted/30 px-4 py-2",children:[(0,n.jsx)("span",{className:"text-xs text-muted-foreground",children:"Markdown 编辑器"}),(0,n.jsx)("span",{className:"text-xs text-muted-foreground",children:"|"}),(0,n.jsx)("span",{className:"text-xs text-amber-400",children:"编辑后的内容将在下次对话中生效"})]}),(0,n.jsx)(N,{className:"flex-1",children:(0,n.jsx)(eo,{value:t,onChange:e=>s(e.target.value),className:"min-h-full w-full resize-none border-0 bg-transparent p-6 font-mono text-sm text-foreground focus-visible:ring-0 focus-visible:ring-offset-0",placeholder:"在此编辑开发计划...",style:{minHeight:"calc(100vh - 200px)"}})})]})}let e8={plan:D.Z,task:O.Z,table:M.Z,config:L.Z,report:R.Z},e9={pending_review:{label:"待审核",className:"bg-amber-500/20 text-amber-400 border-amber-500/30",icon:ej.Z},approved:{label:"已采纳",className:"bg-green-500/20 text-green-400 border-green-500/30",icon:K.Z},rejected:{label:"已拒绝",className:"bg-red-500/20 text-red-400 border-red-500/30",icon:em.Z},deployed:{label:"已部署",className:"bg-blue-500/20 text-blue-400 border-blue-500/30",icon:K.Z},rollback:{label:"已回滚",className:"bg-orange-500/20 text-orange-400 border-orange-500/30",icon:eN.Z}};function e7(e){var t;let{artifact:s,onVersionSelect:a,selectedVersion:d,onStatusChange:l,currentSessionId:o,onNextPendingArtifact:c,hasNextPendingArtifact:u,sessionArtifacts:x=[],onPlanApproved:p,onRevert:h}=e,[g,f]=(0,r.useState)("yaml"),[b,j]=(0,r.useState)(!1),[N,y]=(0,r.useState)(!1),[_,w]=(0,r.useState)(!1),[A,k]=(0,r.useState)(""),[T,E]=(0,r.useState)(""),[S,I]=(0,r.useState)(!1),D=r.useMemo(()=>(null==s?void 0:s.dependencies)&&x?s.dependencies.map(e=>{let t=x.find(t=>t.id===e);if(!t)return null;let s=t.versions.find(e=>e.version===t.currentVersion)||t.versions[0];return"approved"!==s.status&&"deployed"!==s.status?t:null}).filter(Boolean):[],[s,x]),M=(null==s?void 0:s.type)==="task"&&(s.name.includes("dts")||s.name.includes("hive2ck"));(0,r.useEffect)(()=>{E(""),(null==s?void 0:s.type)==="plan"?f("preview"):M?f("gui"):f("yaml")},[null==s?void 0:s.id,null==s?void 0:s.type,M]);let R=(null==s?void 0:s.type)==="plan"&&"yaml"===g?"preview":g,z=d||(null==s?void 0:s.versions.find(e=>e.sessionId===o))||(null==s?void 0:s.versions.find(e=>e.version===s.currentVersion))||(null==s?void 0:s.versions[s.versions.length-1]),Z=null!==(t=null==s?void 0:s.versions.findIndex(e=>e.id===(null==z?void 0:z.id)))&&void 0!==t?t:-1,V=Z>0?null==s?void 0:s.versions[Z-1]:null;if(!s||!z)return(0,n.jsxs)("div",{className:"flex h-full flex-col items-center justify-center p-8 text-center text-muted-foreground",children:[(0,n.jsx)("div",{className:"rounded-full bg-muted p-4 mb-4",children:(0,n.jsx)(O.Z,{className:"h-8 w-8 opacity-50"})}),(0,n.jsx)("h3",{className:"text-lg font-medium text-foreground mb-2",children:"未选择产物"}),(0,n.jsx)("p",{className:"text-sm max-w-xs",children:"请从左侧列表选择一个产物进行查看或评审"})]});let H=eS[s.type],B=e8[s.type],U=e9[z.status]||e9.pending_review;return(0,n.jsxs)("div",{className:"flex h-full flex-col bg-background",children:[D.length>0&&(null==z?void 0:z.status)==="pending_review"&&(0,n.jsxs)("div",{className:"bg-orange-500/10 border-b border-orange-500/20 px-4 py-2 flex items-center justify-between",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2 text-sm text-orange-500",children:[(0,n.jsx)(eN.Z,{className:"h-4 w-4"}),(0,n.jsxs)("span",{children:["当前产物依赖于 ",(0,n.jsx)("strong",{children:D[0].name})," 等 ",D.length," 个前置产物，建议先评审依赖项。"]})]}),(0,n.jsxs)(v,{variant:"outline",size:"sm",className:"h-7 border-orange-500/30 text-orange-500 hover:bg-orange-500/20 hover:text-orange-400",onClick:()=>{i.Am.info("建议优先评审依赖产物：".concat(D[0].name))},children:["查看依赖项",(0,n.jsx)(P.Z,{className:"ml-1 h-3 w-3"})]})]}),z.version!==s.currentVersion&&(0,n.jsxs)("div",{className:"bg-blue-500/10 border-b border-blue-500/20 px-4 py-2 flex items-center justify-between",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2 text-sm text-blue-500",children:[(0,n.jsx)(ey.Z,{className:"h-4 w-4"}),(0,n.jsxs)("span",{children:["当前正在预览历史版本 ",(0,n.jsx)("strong",{children:z.version})," (提交于 ",z.createdAt,")"]})]}),(0,n.jsx)(v,{size:"sm",className:"h-7 bg-blue-600 text-white hover:bg-blue-500 border-none",onClick:()=>{if("true"===localStorage.getItem("skipRollbackConfirm")&&h){h(z);return}y(!0)},children:"回滚至当前版本"})]}),(0,n.jsx)(C,{children:(0,n.jsxs)("div",{className:"flex items-center justify-between border-b border-border bg-ide-panel-header px-4 py-2",children:[(0,n.jsxs)("div",{className:"flex items-center gap-3",children:[(0,n.jsx)(B,{className:"h-4 w-4 text-primary"}),(0,n.jsx)("span",{className:"font-medium text-foreground",children:s.name}),(0,n.jsx)(el,{variant:"outline",className:"text-xs text-foreground",children:H.label}),(0,n.jsx)(el,{className:m("text-xs",U.className),children:U.label})]}),(0,n.jsx)("div",{className:"flex items-center gap-1",children:H.targetPlatform&&(0,n.jsxs)(v,{variant:"outline",size:"sm",className:"mr-2 h-7 gap-1.5 border-primary/30 bg-primary/5 text-xs text-primary hover:bg-primary/10",onClick:()=>{try{var e;let t=null===(e=H.urlTemplate)||void 0===e?void 0:e.replace("{{id}}",s.id);if(!t)throw Error("URL generation failed");i.Am.info("正在前往 ".concat(H.targetPlatform),{description:"正在建立安全连接..."}),setTimeout(()=>{window.open(t,"_blank")||i.Am.error("无法打开新窗口",{description:"请检查浏览器弹窗拦截设置"})},500)}catch(e){i.Am.error("跳转失败",{description:"无法构建有效的目标平台链接"})}},children:[(0,n.jsx)(e_.Z,{className:"h-3.5 w-3.5"}),"在 ",H.targetPlatform," 中打开"]})})]})}),(0,n.jsxs)("div",{className:"flex items-center justify-between border-b border-border bg-ide-panel px-4 py-1",children:[(0,n.jsx)(Y,{value:R,onValueChange:e=>f(e),children:(0,n.jsxs)($,{className:"h-7 gap-1 bg-transparent p-0",children:["plan"===s.type?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(Q,{value:"preview",className:"h-6 px-3 text-xs text-muted-foreground data-[state=active]:bg-ide-selection data-[state=active]:text-foreground",children:[(0,n.jsx)(ew.Z,{className:"mr-1.5 h-3 w-3"}),"预览"]}),(0,n.jsxs)(Q,{value:"edit",className:"h-6 px-3 text-xs text-muted-foreground data-[state=active]:bg-ide-selection data-[state=active]:text-foreground",children:[(0,n.jsx)(eA.Z,{className:"mr-1.5 h-3 w-3"}),"编辑"]})]}):"task"===s.type?M?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(Q,{value:"yaml",className:"h-6 px-3 text-xs text-muted-foreground data-[state=active]:bg-ide-selection data-[state=active]:text-foreground",children:[(0,n.jsx)(O.Z,{className:"mr-1.5 h-3 w-3"}),"YAML"]}),(0,n.jsxs)(Q,{value:"gui",className:"h-6 px-3 text-xs text-muted-foreground data-[state=active]:bg-ide-selection data-[state=active]:text-foreground",children:[(0,n.jsx)(L.Z,{className:"mr-1.5 h-3 w-3"}),"GUI"]})]}):(0,n.jsxs)(Q,{value:"yaml",className:"h-6 px-3 text-xs text-muted-foreground data-[state=active]:bg-ide-selection data-[state=active]:text-foreground",children:[(0,n.jsx)(O.Z,{className:"mr-1.5 h-3 w-3"}),"SQL"]}):"table"===s.type?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(Q,{value:"yaml",className:"h-6 px-3 text-xs text-muted-foreground data-[state=active]:bg-ide-selection data-[state=active]:text-foreground",children:[(0,n.jsx)(O.Z,{className:"mr-1.5 h-3 w-3"}),"DDL"]}),(0,n.jsxs)(Q,{value:"gui",className:"h-6 px-3 text-xs text-muted-foreground data-[state=active]:bg-ide-selection data-[state=active]:text-foreground",children:[(0,n.jsx)(L.Z,{className:"mr-1.5 h-3 w-3"}),"GUI"]})]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(Q,{value:"yaml",className:"h-6 px-3 text-xs text-muted-foreground data-[state=active]:bg-ide-selection data-[state=active]:text-foreground",children:[(0,n.jsx)(O.Z,{className:"mr-1.5 h-3 w-3"}),"YAML"]}),(0,n.jsxs)(Q,{value:"gui",className:"h-6 px-3 text-xs text-muted-foreground data-[state=active]:bg-ide-selection data-[state=active]:text-foreground",children:[(0,n.jsx)(L.Z,{className:"mr-1.5 h-3 w-3"}),"GUI"]})]}),z.previousContent&&(0,n.jsxs)(Q,{value:"diff",className:"h-6 gap-1 px-3 text-xs text-muted-foreground data-[state=active]:bg-ide-selection data-[state=active]:text-foreground",children:[(0,n.jsx)(ek.Z,{className:"mr-1.5 h-3 w-3"}),"Diff",(0,n.jsx)("span",{className:"ml-1 rounded bg-blue-500/20 px-1 text-[10px] text-blue-400",children:"变更"})]})]})}),(0,n.jsx)("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:(0,n.jsxs)(ee,{value:z.version,onValueChange:e=>{let t=s.versions.find(t=>t.version===e);t&&a(t)},children:[(0,n.jsx)(es,{className:"h-6 w-auto border-none bg-transparent p-0 text-xs text-muted-foreground hover:text-foreground focus:ring-0 shadow-none gap-2 data-[placeholder]:text-muted-foreground [&>span]:line-clamp-1",children:(0,n.jsxs)("div",{className:"flex items-center gap-2 cursor-pointer",children:[(0,n.jsx)(eT.Z,{className:"h-3.5 w-3.5"}),(0,n.jsxs)("span",{children:["版本: ",z.version]}),(0,n.jsx)("span",{className:"text-border mx-1",children:"|"}),(0,n.jsx)(ey.Z,{className:"h-3.5 w-3.5"}),(0,n.jsx)("span",{children:z.createdAt})]})}),(0,n.jsx)(en,{align:"end",className:"w-[200px]",children:s.versions.slice().reverse().map(e=>(0,n.jsx)(er,{value:e.version,children:(0,n.jsxs)("div",{className:"flex flex-col gap-0.5 text-left",children:[(0,n.jsxs)("span",{className:"font-medium flex items-center gap-2",children:[e.version,e.version===s.currentVersion&&(0,n.jsx)(el,{variant:"outline",className:"text-[9px] h-3.5 px-1 py-0",children:"Latest"})]}),(0,n.jsx)("span",{className:"text-[10px] text-muted-foreground",children:e.createdAt})]})},e.id))})]})})]}),(0,n.jsxs)("div",{className:"flex-1 overflow-hidden",children:["yaml"===R&&(0,n.jsx)(eO,{content:z.yamlContent}),"gui"===R&&(0,n.jsx)(eq,{artifact:s,version:z,editedContent:T||void 0,onContentChange:E}),"preview"===R&&"plan"===s.type&&(0,n.jsx)(e4,{content:z.yamlContent,onApprove:"pending_review"===z.status?()=>null==p?void 0:p(s.id):void 0}),"edit"===R&&"plan"===s.type&&(0,n.jsx)(e6,{content:T||z.yamlContent,onChange:E}),"diff"===R&&z.previousContent&&(0,n.jsx)(e3,{oldContent:z.previousContent,newContent:z.yamlContent,oldTitle:"v".concat(Number.parseInt(z.version.slice(1))-1," (旧版本)"),newTitle:"".concat(z.version," (当前版本)")})]}),(0,n.jsx)("div",{className:m("border-t px-4 py-3","pending_review"===z.status&&"border-amber-500/30 bg-amber-500/5","approved"===z.status&&"border-green-500/30 bg-green-500/5","rejected"===z.status&&"border-red-500/30 bg-red-500/5","deployed"===z.status&&"border-blue-500/30 bg-blue-500/5"),children:(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsxs)("div",{className:"flex items-center gap-3",children:[(0,n.jsxs)("div",{className:m("flex h-8 w-8 items-center justify-center rounded-full","pending_review"===z.status&&"bg-amber-500/20","approved"===z.status&&"bg-green-500/20","rejected"===z.status&&"bg-red-500/20","deployed"===z.status&&"bg-blue-500/20"),children:["pending_review"===z.status&&(0,n.jsx)(ej.Z,{className:"h-4 w-4 text-amber-400"}),"approved"===z.status&&(0,n.jsx)(K.Z,{className:"h-4 w-4 text-green-400"}),"rejected"===z.status&&(0,n.jsx)(em.Z,{className:"h-4 w-4 text-red-400"}),"deployed"===z.status&&(0,n.jsx)(K.Z,{className:"h-4 w-4 text-blue-400"})]}),(0,n.jsxs)("div",{children:[(0,n.jsxs)("p",{className:m("text-sm font-medium","pending_review"===z.status&&"text-foreground","approved"===z.status&&"text-green-400","rejected"===z.status&&"text-red-400","deployed"===z.status&&"text-blue-400"),children:["pending_review"===z.status&&"此产物待审核","approved"===z.status&&"此产物已采纳","rejected"===z.status&&"此产物已被拒绝","deployed"===z.status&&"此产物已部署"]}),(0,n.jsxs)("p",{className:"text-xs text-muted-foreground",children:["pending_review"===z.status&&"请审核此版本的变更内容","approved"===z.status&&"可进行后续部署操作","rejected"===z.status&&"请查看会话记录了解详情","deployed"===z.status&&"已部署到生产环境"]})]})]}),(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[("approved"===z.status||"rejected"===z.status||"deployed"===z.status)&&(0,n.jsxs)(v,{variant:"outline",size:"sm",className:"h-8 gap-1.5 border-orange-500/30 bg-transparent px-3 text-orange-400 hover:bg-orange-500/10",onClick:()=>{"true"===localStorage.getItem("skipRollbackConfirm")?V&&h?h(V):null==l||l(s.id,z.id,"pending_review"):y(!0)},children:[(0,n.jsx)(eC.Z,{className:"h-3.5 w-3.5"}),"回滚到上一版本"]}),"pending_review"===z.status&&"plan"===s.type&&(0,n.jsxs)(v,{size:"sm",className:"h-8 gap-1.5 bg-primary px-3 text-white hover:bg-primary/90",onClick:()=>null==p?void 0:p(s.id),children:[(0,n.jsx)(eE.Z,{className:"h-3.5 w-3.5"}),"采纳并进行开发"]}),"pending_review"===z.status&&"plan"!==s.type&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(v,{variant:"outline",size:"sm",className:"h-8 gap-1.5 border-red-500/30 bg-transparent px-3 text-red-400 hover:bg-red-500/10",onClick:()=>j(!0),children:[(0,n.jsx)(em.Z,{className:"h-3.5 w-3.5"}),"拒绝"]}),(0,n.jsxs)(v,{size:"sm",className:"h-8 gap-1.5 bg-green-600 px-3 text-white hover:bg-green-500",onClick:()=>{null==l||l(s.id,z.id,"approved"),u&&setTimeout(()=>null==c?void 0:c(),300)},children:[(0,n.jsx)(K.Z,{className:"h-3.5 w-3.5"}),"采纳"]})]}),u&&(0,n.jsx)("div",{className:"h-6 w-px bg-border mx-1"}),u&&(0,n.jsxs)(v,{size:"sm",className:"h-8 gap-1.5 bg-primary px-3 text-white hover:bg-primary/90",onClick:c,children:["下一个",(0,n.jsx)(P.Z,{className:"h-3.5 w-3.5"})]})]})]})}),(0,n.jsxs)("div",{className:"flex items-center justify-between border-t border-border bg-ide-panel px-4 py-1.5 text-xs",children:[(0,n.jsxs)("div",{className:"flex items-center gap-4 text-muted-foreground",children:[(0,n.jsxs)("span",{children:["创建者: ",z.createdBy]}),(0,n.jsxs)("span",{children:["路径: ",s.path]})]}),(0,n.jsx)("div",{className:"text-muted-foreground",children:z.changeDescription})]}),(0,n.jsx)(eu,{open:b,onOpenChange:j,children:(0,n.jsxs)(eh,{className:"bg-card",children:[(0,n.jsxs)(eg,{children:[(0,n.jsx)(ev,{children:"拒绝产物变更"}),(0,n.jsx)(eb,{children:"请提供拒绝此产物变更的原因，以便后续改进"})]}),(0,n.jsx)("div",{className:"py-4",children:(0,n.jsx)(eo,{placeholder:"请输入拒绝原因（可选）",value:A,onChange:e=>k(e.target.value),className:"min-h-[100px] resize-none border-border bg-input text-foreground placeholder:text-muted-foreground"})}),(0,n.jsxs)(ef,{children:[(0,n.jsx)(v,{variant:"outline",onClick:()=>{j(!1),k("")},className:"border-border bg-transparent text-foreground hover:bg-ide-hover",children:"取消"}),(0,n.jsx)(v,{className:"bg-red-600 text-white hover:bg-red-500",onClick:()=>{null==l||l(s.id,z.id,"rejected",A),j(!1),k("")},children:"确认拒绝"})]})]})}),(0,n.jsx)(eu,{open:N,onOpenChange:y,children:(0,n.jsxs)(eh,{className:"bg-card",children:[(0,n.jsxs)(eg,{children:[(0,n.jsx)(ev,{className:"text-foreground",children:"确认回滚"}),(0,n.jsxs)(eb,{children:["您确定要将 ",(0,n.jsx)("strong",{children:null==s?void 0:s.name})," 回滚到 ",(0,n.jsx)("strong",{children:V?V.version:"待审核状态"})," 吗？"]})]}),(0,n.jsx)("div",{className:"rounded-lg bg-muted/50 p-3 text-sm text-muted-foreground",children:(0,n.jsxs)("div",{className:"flex items-start gap-2",children:[(0,n.jsx)(eC.Z,{className:"mt-0.5 h-4 w-4 shrink-0 text-orange-400"}),(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"font-medium text-foreground",children:"回滚操作说明"}),(0,n.jsxs)("ul",{className:"mt-1.5 space-y-1 text-xs",children:[(0,n.jsxs)("li",{children:["• 此操作仅回滚当前产物，",(0,n.jsx)("strong",{children:"不影响"}),"其他关联产物"]}),(0,n.jsx)("li",{children:"• 回滚后需要重新审核才能部署"}),(0,n.jsx)("li",{children:"• 已部署的版本不会受到影响"})]})]})]})}),(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("input",{type:"checkbox",id:"skipRollbackConfirm",checked:_,onChange:e=>w(e.target.checked),className:"h-4 w-4 rounded border-border bg-input accent-primary"}),(0,n.jsx)("label",{htmlFor:"skipRollbackConfirm",className:"text-sm text-muted-foreground cursor-pointer",children:"下次不再提示"})]}),(0,n.jsxs)(ef,{children:[(0,n.jsx)(v,{variant:"outline",onClick:()=>{y(!1),w(!1)},className:"border-border bg-transparent text-foreground hover:bg-ide-hover",children:"取消"}),(0,n.jsx)(v,{className:"bg-orange-600 text-white hover:bg-orange-500",onClick:()=>{_&&localStorage.setItem("skipRollbackConfirm","true"),h&&z.version!==s.currentVersion?h(z):h&&V?h(V):null==l||l(s.id,z.id,"pending_review"),y(!1),w(!1)},children:"确认回滚"})]})]})})]})}var te=s(8119);function tt(e){let{...t}=e;return(0,n.jsx)(te.fC,{"data-slot":"dropdown-menu",...t})}function ts(e){let{...t}=e;return(0,n.jsx)(te.xz,{"data-slot":"dropdown-menu-trigger",...t})}function tn(e){let{className:t,sideOffset:s=4,...r}=e;return(0,n.jsx)(te.Uv,{children:(0,n.jsx)(te.VY,{"data-slot":"dropdown-menu-content",sideOffset:s,className:m("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 max-h-(--radix-dropdown-menu-content-available-height) min-w-[8rem] origin-(--radix-dropdown-menu-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border p-1 shadow-md",t),...r})})}function tr(e){let{className:t,inset:s,variant:r="default",...a}=e;return(0,n.jsx)(te.ck,{"data-slot":"dropdown-menu-item","data-inset":s,"data-variant":r,className:m("focus:bg-accent focus:text-accent-foreground data-[variant=destructive]:text-destructive data-[variant=destructive]:focus:bg-destructive/10 dark:data-[variant=destructive]:focus:bg-destructive/20 data-[variant=destructive]:focus:text-destructive data-[variant=destructive]:*:[svg]:!text-destructive [&_svg:not([class*='text-'])]:text-muted-foreground relative flex cursor-default items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 data-[inset]:pl-8 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",t),...a})}var ta=s(2934),ti=s(6865),td=s(9388),tl=s(5846),to=s(5675),tc=s(2369),tm=s(2222),tu=s(4794),tx=s(1810),tp=s(7157),th=s(8867),tg=s(1414),tf=s(2800),tv=s(4743),tb=s(2655);let tj={low:{label:"低风险",badgeClass:"bg-green-500/20 text-green-400",icon:ta.Z,description:"支持完全回滚到任意历史版本"},medium:{label:"中风险",badgeClass:"bg-yellow-500/20 text-yellow-400",icon:ti.Z,description:"仅支持有限回滚，部分变更可能不可恢复"},high:{label:"高风险",badgeClass:"bg-red-500/20 text-red-400",icon:td.Z,description:"不支持回滚，请谨慎操作"}},tN={pending_review:{label:"待发布",className:"bg-amber-500/20 text-amber-400"},approved:{label:"已采纳",className:"bg-green-500/20 text-green-400"},rejected:{label:"已拒绝",className:"bg-red-500/20 text-red-400"},deployed:{label:"已部署",className:"bg-blue-500/20 text-blue-400"},rollback:{label:"已回滚",className:"bg-orange-500/20 text-orange-400"}},ty={plan:D.Z,task:O.Z,table:M.Z,config:L.Z,report:R.Z},t_={plan:"text-green-500",task:"text-blue-500",table:"text-cyan-500",config:"text-orange-500",report:"text-purple-500"},tw={planning:{label:"规划中",color:"text-cyan-400 bg-cyan-500/20",description:"正在生成开发计划..."},plan_review:{label:"计划评审",color:"text-amber-400 bg-amber-500/20",description:"请审核并修改计划"},developing:{label:"开发中",color:"text-blue-400 bg-blue-500/20",description:"正在生成产物..."},dev_review:{label:"产物评审",color:"text-purple-400 bg-purple-500/20",description:"请审核产物"},completed:{label:"已完成",color:"text-green-400 bg-green-500/20",description:"所有产物已审核完成"}};function tA(e){let{data:t,onSelect:s}=e,[a,i]=(0,r.useState)(t.selectedOptionId);(0,r.useEffect)(()=>{t.selectedOptionId&&i(t.selectedOptionId)},[t.selectedOptionId]);let d=!!t.selectedOptionId;return(0,n.jsxs)("div",{className:"mt-3 w-full max-w-[480px] overflow-hidden rounded-xl border border-border bg-card text-card-foreground shadow-sm animate-in fade-in slide-in-from-bottom-2",children:[(0,n.jsxs)("div",{className:"border-b border-border bg-muted/30 px-4 py-3 flex items-center gap-2",children:[(0,n.jsx)("div",{className:"flex h-6 w-6 items-center justify-center rounded-md bg-primary/10",children:(0,n.jsx)(eE.Z,{className:"h-3.5 w-3.5 text-primary"})}),(0,n.jsx)("span",{className:"text-sm font-semibold",children:t.title})]}),(0,n.jsxs)("div",{className:"p-4 space-y-4",children:[(0,n.jsx)("p",{className:"text-sm text-foreground font-medium",children:t.question}),(0,n.jsx)("div",{className:"space-y-2",children:t.options.map(e=>(0,n.jsxs)("div",{className:m("relative flex gap-3 rounded-lg border p-3 transition-all",a===e.id?"border-primary bg-primary/5 ring-1 ring-primary/20":"border-border hover:bg-accent/50 hover:border-primary/30",d?"cursor-default opacity-80":"cursor-pointer"),onClick:()=>!d&&i(e.id),children:[(0,n.jsx)("div",{className:m("mt-0.5 flex h-4 w-4 shrink-0 items-center justify-center rounded-full border transition-colors",a===e.id?"border-primary bg-primary text-primary-foreground":"border-muted-foreground"),children:a===e.id&&(0,n.jsx)("div",{className:"h-1.5 w-1.5 rounded-full bg-current"})}),(0,n.jsxs)("div",{className:"flex-1 space-y-0.5",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("span",{className:"text-sm font-medium leading-none",children:e.label}),e.recommended&&(0,n.jsx)("span",{className:"text-[10px] bg-primary/10 text-primary px-1.5 py-0.5 rounded-full",children:"推荐"})]}),e.desc&&(0,n.jsx)("p",{className:"text-xs text-muted-foreground leading-snug",children:e.desc})]})]},e.id))})]}),(0,n.jsxs)("div",{className:"flex items-center justify-between border-t border-border bg-muted/30 px-4 py-2.5",children:[(0,n.jsxs)("span",{className:"text-xs text-muted-foreground",children:["步骤 ",t.step,"/",t.totalSteps]}),(0,n.jsx)("div",{className:"flex gap-2",children:(0,n.jsxs)(v,{size:"sm",className:"h-7 text-xs bg-primary text-primary-foreground hover:bg-primary/90 shadow-sm",disabled:!a||d,onClick:()=>{var e;return a&&s(a,(null===(e=t.options.find(e=>e.id===a))||void 0===e?void 0:e.label)||"")},children:[d?"已提交":t.step===t.totalSteps?"完成":"下一步",!d&&(0,n.jsx)(P.Z,{className:"ml-1 h-3 w-3"})]})})]})]})}function tk(e){let{sessions:t,currentSessionId:s,artifact:a,selectedVersion:i,onVersionSelect:d,onSessionChange:l,onBatchApproveByType:o,onBatchApproveAll:c,onNewSession:u,onArtifactsGenerated:x,pendingStats:p,sessionArtifacts:h=[],onSelectArtifact:g}=e,[f,j]=(0,r.useState)("session"),[y,_]=(0,r.useState)(!1),[T,C]=(0,r.useState)(null),[E,S]=(0,r.useState)(""),[I,D]=(0,r.useState)(!1),[z,Z]=(0,r.useState)(""),[V,P]=(0,r.useState)(!1),[B,W]=(0,r.useState)(!0),[F,q]=(0,r.useState)(!1),[G,Y]=(0,r.useState)([]),[$,Q]=(0,r.useState)(!1),X=(0,r.useRef)(null),ee=(e,t,s)=>{Y(s=>s.map(s=>s.id===e&&s.hitlData?{...s,hitlData:{...s.hitlData,selectedOptionId:t}}:s));let n={id:"msg-".concat(Date.now(),"-resp"),role:"user",content:"我选择了：".concat(s),timestamp:new Date().toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"})};Y(e=>[...e,n]),Q(!0),setTimeout(()=>{if(e.includes("hitl-1")){let e={id:"msg-".concat(Date.now(),"-hitl-2"),role:"assistant",content:"请确认统计周期... (HITL Request)",timestamp:new Date().toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),hitlData:{step:2,totalSteps:2,title:"统计周期与产出要求",question:"请确认该指标的更新频率：",options:[{id:"opt1",label:"T+1 离线 (Hive)",desc:"每日凌晨计算，产出 dm_daily_metric",recommended:!0},{id:"opt2",label:"T+0 准实时 (ClickHouse)",desc:"每小时微批处理，产出 dm_realtime_metric"}]}};Y(t=>[...t,e]),Q(!1)}else if(e.includes("hitl-2")){let e="session-plan-".concat(Date.now()),t=z||"电商指标开发 (Plan)",s="group-plan-".concat(Date.now()),n=[{type:"plan",name:"implementation_plan_metric.md",path:"LeapAgentDemos/new_session/implementation_plan_metric.md"}],r={id:"msg-".concat(Date.now(),"-final"),role:"assistant",content:"配置确认完成。已为您生成详细的实施计划，请审阅。",timestamp:new Date().toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),thinking:"分析：所有关键信息已确认\n生成：实施计划文档\n下一步：等待用户 Approve",isThinkingExpanded:!0,generatedFiles:n};Y(a=>{let i=[...a,r];return x&&x({sessionId:e,sessionTitle:t,files:n,groupId:s,groupName:"电商指标开发",history:i.map(e=>({role:e.role,content:e.content||""}))}),i}),Q(!1),D(!1),Y([])}},1e3)},et=(0,r.useRef)(null),es=t.find(e=>e.id===s);(0,r.useEffect)(()=>{X.current&&X.current.scrollIntoView({behavior:"smooth"})},[G,$,null==es?void 0:es.messages,f]),(null==es?void 0:es.phase)&&tw[es.phase];let en=a?eS[a.type]:null,er=en?tj[en.riskLevel]:null,ea=()=>{if(E.trim()){if(I){let e={id:"new-msg-".concat(Date.now()),role:"user",content:E,timestamp:new Date().toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"})};if(Y(t=>[...t,e]),E.toLowerCase().includes("hive2ck")||E.toLowerCase().includes("hive to ck")||E.includes("数据集成")||E.includes("Hive")&&(E.includes("CK")||E.includes("ClickHouse"))){Q(!0);let e="session-new-".concat(Date.now()),t=z||"创建 Hive2CK 数据集成任务",s="group-".concat(Date.now());setTimeout(()=>{let n=[{type:"folder",name:"数据集成-dm_shop_metrics",path:"LeapAgentDemos/new_session"},{type:"task",name:"dts_hive2ck_shop_metrics",path:"LeapAgentDemos/new_session/数据集成-dm_shop_metrics",changes:{added:32,removed:0},dependencyOrder:2},{type:"table",name:"dm_shop_metrics_ck",path:"LeapAgentDemos/new_session/数据集成-dm_shop_metrics",changes:{added:28,removed:0},dependencyOrder:1}],r={id:"new-msg-".concat(Date.now(),"-assistant"),role:"assistant",content:"好的，我将为您创建 Hive 到 ClickHouse 的数据集成任务。\n\n⚠️ **注意**：请先采纳 CK 目标表，再采纳 DTS 任务。\n\n已生成以下文件：",timestamp:new Date().toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),thinking:"分析需求：用户需要创建 Hive → ClickHouse 数据集成任务\n\n1. 检测源表：Hive 表 dm.shop_metrics 已存在\n2. 检测目标：ClickHouse 集群可达\n\n✓ 生成 2 个产物：\n  • CK 目标表 (table): dm_shop_metrics_ck\n  • DTS 同步任务 (task): dts_hive2ck_shop_metrics\n\n⚠️ 依赖关系：DTS 任务依赖 CK 表先创建",isThinkingExpanded:!0,generatedFiles:n};Y(e=>[...e,r]),Q(!1),z||Z(t),x&&x({sessionId:e,sessionTitle:t,files:n,groupId:s,groupName:"数据集成任务组"}),D(!1),Y([])},1500)}else if(E.includes("多版本修改")){Q(!0);let e="session-multi-".concat(Date.now()),t=z||"HiveSQL 多版本修改",s="group-multi-".concat(Date.now());setTimeout(()=>{let n=[{type:"folder",name:"任务-dm_user_order_stats_mv",path:"LeapAgentDemos/multi_version_task"},{type:"task",name:"dm_user_order_stats_mv.sql",path:"LeapAgentDemos/multi_version_task/dm_user_order_stats_mv",changes:{added:15,removed:5}},{type:"config",name:"dm_user_order_stats_mv.config",path:"LeapAgentDemos/multi_version_task/dm_user_order_stats_mv"}],r={id:"new-msg-".concat(Date.now(),"-assistant"),role:"assistant",content:"已为您发起多版本修改任务。检测到现有任务存在多个历史版本，正在为您生成 V5 版本草稿。",timestamp:new Date().toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),thinking:"分析：用户请求多版本修改\n目标：生成 V5 版本，保留 V1-V4 回滚能力。\n1. 创建新任务版本 V5\n2. 关联历史版本 V1-V4\n3. 生成配置变更",isThinkingExpanded:!0,generatedFiles:n};Y(e=>[...e,r]),Q(!1),z||Z(t),x&&x({sessionId:e,sessionTitle:t,files:n,groupId:s,groupName:"HiveSQL 多版本任务",isMultiVersion:!0}),D(!1),Y([])},1500)}else if(!V||E.includes("编辑")||E.includes("修改")){if(E.includes("采纳冲突")){Q(!0);let e="session-conflict-".concat(Date.now()),t=z||"采纳冲突演示",s="group-conflict-".concat(Date.now());setTimeout(()=>{let n=[{type:"folder",name:"冲突任务-demo_conflict_task",path:"LeapAgentDemos/conflict_case"},{type:"task",name:"demo_conflict_task.sql",path:"LeapAgentDemos/conflict_case/demo_conflict_task",changes:{added:10,removed:2}}],r={id:"new-msg-".concat(Date.now(),"-assistant"),role:"assistant",content:"检测到您正在修改公共任务 `demo_conflict_task.sql`。在该任务的最新线上版本（v10）之上，另一位同事（zhangsan）已经提交了未发布的变更（v11-draft）。\n\n为了避免覆盖他的工作，建议您基于最新版本进行冲突解决。",timestamp:new Date().toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),thinking:"分析：检测到版本冲突\n冲突源：zhangsan 已有 v11-draft，当前基于 v10 修改\n建议：提示用户解决冲突",isThinkingExpanded:!0,generatedFiles:n};Y(e=>[...e,r]),Q(!1),z||Z(t),x&&x({sessionId:e,sessionTitle:t,files:n,groupId:s,groupName:"采纳冲突演示",isMultiVersion:!0}),D(!1),Y([])},1500)}else if(E.includes("HiveSQL")||E.includes("创建")&&E.includes("任务")){if(V){G.find(e=>e.hitlData)||(Q(!0),setTimeout(()=>{let e={id:"msg-".concat(Date.now(),"-hitl-1"),role:"assistant",content:"正在解析需求... (HITL Request)",timestamp:new Date().toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),thinking:"分析：用户启用 Plan 模式\n决策：启动 HITL 交互式澄清流程",isThinkingExpanded:!0,hitlData:{step:1,totalSteps:2,title:"口径与数据源确认",question:"请确认统计口径“加购”的定义以及首选数据源：",options:[{id:"opt1",label:"常规加购 (ods.app_cart)",desc:"用户点击加购按钮触发，数据量大，包含未登录用户"},{id:"opt2",label:"有效加购 (dwd.trade_cart)",desc:"成功写入购物车表，数据准确，适合转化分析",recommended:!0},{id:"opt3",label:"自定义 SQL",desc:"手动编写 SQL 逻辑"}]}};Y(t=>[...t,e]),Q(!1)},1e3));return}Q(!0);let e="session-new-".concat(Date.now()),t=z||"创建 HiveSQL 任务",s="group-hive-".concat(Date.now());setTimeout(()=>{let n=[{type:"folder",name:"任务-dm_gvn_shop_exp_metric_extend_df",path:"LeapAgentDemos/new_session"},{type:"sql",name:"dm_gvn_shop_exp_metric_extend_df.sql",path:"LeapAgentDemos/new_session/任务-dm_gvn_shop_exp_metric_extend_df",changes:{added:25,removed:6}},{type:"config",name:"dm_gvn_shop_exp_metric_extend_df.config",path:"LeapAgentDemos/new_session/任务-dm_gvn_shop_exp_metric_extend_df"}],r={id:"new-msg-".concat(Date.now(),"-assistant"),role:"assistant",content:"好的，我将为您创建一个 HiveSQL 离线任务。已生成以下文件：",timestamp:new Date().toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),thinking:"分析需求：用户需要创建 HiveSQL 任务\n\n1. 解析任务类型：离线批处理任务\n2. 确定数据源：需要从用户指定的源表读取\n3. 生成 SQL 代码：包含 INSERT OVERWRITE 语句\n4. 配置调度参数：设置执行时间和依赖关系\n\n正在生成文件...",isThinkingExpanded:!0,generatedFiles:n};Y(e=>[...e,r]),Q(!1),z||Z(t),x&&x({sessionId:e,sessionTitle:t,files:n,groupId:s,groupName:"HiveSQL 任务-dm_gvn_shop_exp_metric_extend_df"}),D(!1),Y([])},1500)}else if(E.includes("编辑任务")||E.includes("修改任务")){let e=E.replace(/编辑任务|修改任务/g,"").trim()||"dm_user_order_stats_df";if(V){Q(!0);let t="session-plan-edit-".concat(Date.now()),s=z||"编辑任务计划: ".concat(e),n="group-plan-".concat(Date.now());setTimeout(()=>{let r=[{type:"plan",name:"implementation_plan_v2.md",path:"LeapAgentDemos/edit_session/implementation_plan_v2.md"}],a={id:"new-msg-".concat(Date.now(),"-assistant"),role:"assistant",content:"好的，针对任务 **".concat(e,"** 的修改需求，我制定了新的实施计划。请在左侧查看 **implementation_plan_v2.md**。"),timestamp:new Date().toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),thinking:"分析需求：用户在编辑模式下开启 Plan\n\n1. 目标：修改现有任务\n2. 策略：先出计划，再执行\n3. 生成产物：Plan 文档",isThinkingExpanded:!0,generatedFiles:r};Y(e=>[...e,a]),Q(!1),z||Z(s),x&&x({sessionId:t,sessionTitle:s,files:r,groupId:n,groupName:"计划-编辑 ".concat(e)}),D(!1),Y([])},1500);return}Q(!0);let t="session-edit-".concat(Date.now()),s=z||"编辑任务 ".concat(e),n="group-edit-".concat(Date.now());setTimeout(()=>{let r=[{type:"task",name:e,path:"LeapAgentDemos/edit_session",changes:{added:8,removed:3},isEdit:!0},{type:"config",name:"".concat(e,".config"),path:"LeapAgentDemos/edit_session",changes:{added:12,removed:5},isEdit:!0}],a={id:"new-msg-".concat(Date.now(),"-assistant"),role:"assistant",content:"好的，我已根据您的需求修改了任务 **".concat(e,"**。\n\n修改内容包括：\n\n**SQL 变更**\n- 新增字段 `refund_count` 计算退款订单数\n- 优化 `avg_order_amount` 计算逻辑，排除退款订单\n\n**调度配置变更**\n- 调整执行时间从 02:00 改为 03:00\n- 新增重试策略，失败后自动重试 3 次\n\n请查看左侧的 **Diff** 视图确认变更，确认后可采纳。"),timestamp:new Date().toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),thinking:"分析需求：用户需要编辑现有 HiveSQL 任务 ".concat(e,"\n\n1. 检索任务历史版本：v1 已部署于 2025-12-01\n2. 解析修改意图：\n   - 添加退款指标计算\n   - 优化现有计算逻辑\n   - 更新调度时间\n3. 生成新版本：v2\n4. 保留历史版本用于 Diff 对比\n\n✓ 已生成变更：\n  • SQL 内容：+8 行 / -3 行\n  • 调度配置：+12 行 / -5 行"),generatedFiles:r};Y(e=>[...e,a]),Q(!1),x&&x({sessionId:t,sessionTitle:s,files:r,isEdit:!0,groupId:n,groupName:"HiveSQL 任务-".concat(e)}),D(!1),Y([])},1500)}else setTimeout(()=>{let e={id:"new-msg-".concat(Date.now(),"-assistant"),role:"assistant",content:"好的，我正在处理您的请求...",timestamp:new Date().toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"})};Y(t=>[...t,e])},500)}else{G.find(e=>e.hitlData)||(Q(!0),setTimeout(()=>{let e={id:"msg-".concat(Date.now(),"-hitl-1"),role:"assistant",content:"正在解析需求... (HITL Request)",timestamp:new Date().toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),thinking:"分析：用户启用 Plan 模式\n决策：启动 HITL 交互式澄清流程",isThinkingExpanded:!0,hitlData:{step:1,totalSteps:2,title:"口径与数据源确认",question:"请确认统计口径“加购”的定义以及首选数据源：",options:[{id:"opt1",label:"常规加购 (ods.app_cart)",desc:"用户点击加购按钮触发，数据量大，包含未登录用户"},{id:"opt2",label:"有效加购 (dwd.trade_cart)",desc:"成功写入购物车表，数据准确，适合转化分析",recommended:!0},{id:"opt3",label:"自定义 SQL",desc:"手动编写 SQL 逻辑"}]}};Y(t=>[...t,e]),Q(!1)},1e3));return}S("")}else console.log("[Session] Sending message:",E),S("")}},ei=e=>{D(!1),Y([]),Z(""),l(e)},ed=e=>{Y(t=>t.map(t=>t.id===e?{...t,isThinkingExpanded:!t.isThinkingExpanded}:t))};return h.filter(e=>"pending_review"===(e.versions.find(t=>t.version===e.currentVersion)||e.versions[0]).status),(0,n.jsxs)("div",{className:"flex h-full flex-col border-l border-border bg-sidebar",children:[(0,n.jsx)("div",{className:"shrink-0 border-b border-border bg-ide-panel-header",children:I?(0,n.jsxs)("div",{className:"px-3 py-2",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,n.jsx)("span",{className:"text-xs text-muted-foreground",children:"新会话"}),(0,n.jsx)(v,{variant:"ghost",size:"icon",className:"h-6 w-6 text-muted-foreground hover:text-foreground",onClick:()=>{D(!1),Z(""),S("")},children:(0,n.jsx)(em.Z,{className:"h-3.5 w-3.5"})})]}),(0,n.jsxs)(tt,{children:[(0,n.jsx)(ts,{asChild:!0,children:(0,n.jsxs)(v,{variant:"ghost",size:"sm",className:"h-8 w-full justify-between gap-1 px-2 text-sm font-medium text-foreground hover:bg-ide-hover",children:[(0,n.jsx)("span",{className:"truncate",children:z||"新建会话"}),(0,n.jsx)(H.Z,{className:"h-3.5 w-3.5 shrink-0 text-muted-foreground"})]})}),(0,n.jsxs)(tn,{align:"start",className:"w-72 bg-popover",children:[(0,n.jsxs)(tr,{className:"flex items-center gap-2 cursor-pointer py-2 bg-ide-selection",children:[(0,n.jsx)(eF.Z,{className:"h-3.5 w-3.5 text-primary shrink-0"}),(0,n.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,n.jsx)("div",{className:"truncate text-sm",children:z||"新建会话"}),(0,n.jsx)("div",{className:"text-[10px] text-muted-foreground",children:"当前"})]}),(0,n.jsx)(K.Z,{className:"h-3.5 w-3.5 text-primary shrink-0"})]}),(0,n.jsx)("div",{className:"my-1 border-t border-border"}),t.map(e=>(0,n.jsxs)(tr,{onClick:()=>ei(e.id),className:"flex items-center gap-2 cursor-pointer py-2",children:[e.planArtifactId?(0,n.jsx)(tl.Z,{className:"h-3.5 w-3.5 text-cyan-400 shrink-0"}):"create"===e.changeType?(0,n.jsx)(eF.Z,{className:"h-3.5 w-3.5 text-green-400 shrink-0"}):(0,n.jsx)(to.Z,{className:"h-3.5 w-3.5 text-blue-400 shrink-0"}),(0,n.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,n.jsx)("div",{className:"truncate text-sm",children:e.title}),(0,n.jsx)("div",{className:"text-[10px] text-muted-foreground",children:e.updatedAt})]})]},e.id))]})]})]}):(0,n.jsxs)("div",{className:"px-3 py-2",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,n.jsx)("span",{className:"text-xs text-muted-foreground",children:"当前会话"}),(0,n.jsxs)(v,{variant:"ghost",size:"sm",className:"h-6 gap-1 px-2 text-xs text-primary hover:bg-primary/10",onClick:()=>{D(!0),Z(""),S(""),j("session"),setTimeout(()=>{var e;return null===(e=et.current)||void 0===e?void 0:e.focus()},100)},children:[(0,n.jsx)(eF.Z,{className:"h-3 w-3"}),"新会话"]})]}),(0,n.jsxs)(tt,{children:[(0,n.jsx)(ts,{asChild:!0,children:(0,n.jsxs)(v,{variant:"ghost",size:"sm",className:"h-8 w-full justify-between gap-1 px-2 text-sm font-medium text-foreground hover:bg-ide-hover",children:[(0,n.jsx)("span",{className:"truncate",children:(null==es?void 0:es.title)||"选择会话"}),(0,n.jsx)(H.Z,{className:"h-3.5 w-3.5 shrink-0 text-muted-foreground"})]})}),(0,n.jsx)(tn,{align:"start",className:"w-72 bg-popover",children:t.map(e=>(0,n.jsxs)(tr,{onClick:()=>l(e.id),className:m("flex items-center gap-2 cursor-pointer py-2",e.id===s&&"bg-ide-selection"),children:[e.planArtifactId?(0,n.jsx)(tl.Z,{className:"h-3.5 w-3.5 text-cyan-400 shrink-0"}):"create"===e.changeType?(0,n.jsx)(eF.Z,{className:"h-3.5 w-3.5 text-green-400 shrink-0"}):(0,n.jsx)(to.Z,{className:"h-3.5 w-3.5 text-blue-400 shrink-0"}),(0,n.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,n.jsx)("div",{className:"truncate text-sm",children:e.title}),(0,n.jsx)("div",{className:"text-[10px] text-muted-foreground",children:e.updatedAt})]}),e.id===s&&(0,n.jsx)(K.Z,{className:"h-3.5 w-3.5 text-primary shrink-0"})]},e.id))})]})]})}),(0,n.jsxs)(N,{className:"flex-1 overflow-hidden min-h-0",children:[I?(0,n.jsx)("div",{className:"p-3 space-y-4",children:0===G.length?(0,n.jsxs)("div",{className:"flex flex-col items-center justify-center min-h-[280px]",children:[(0,n.jsx)("div",{className:"rounded-full bg-primary/10 p-4 mb-4",children:(0,n.jsx)(eE.Z,{className:"h-8 w-8 text-primary"})}),(0,n.jsx)("h3",{className:"text-lg font-medium text-foreground mb-2",children:"开始新会话"}),(0,n.jsx)("p",{className:"text-sm text-muted-foreground text-center max-w-xs",children:"描述您的需求，AI 助手将帮助您完成数据开发任务"}),(0,n.jsxs)("div",{className:"mt-6 flex flex-wrap gap-2 justify-center",children:[(0,n.jsx)(el,{variant:"outline",className:"cursor-pointer hover:bg-muted",onClick:()=>S("帮我创建一个 HiveSQL 任务"),children:"创建离线任务"}),(0,n.jsx)(el,{variant:"outline",className:"cursor-pointer hover:bg-muted",onClick:()=>S("创建 Hive2CK 数据集成任务"),children:"创建 DTS 任务"}),(0,n.jsx)(el,{variant:"outline",className:"cursor-pointer hover:bg-muted border-amber-500/50 text-amber-400 hover:bg-amber-500/10",onClick:()=>S("编辑任务 dm_user_order_stats_df"),children:"编辑任务"}),(0,n.jsx)(el,{variant:"outline",className:"cursor-pointer hover:bg-muted border-blue-500/50 text-blue-400 hover:bg-blue-500/10",onClick:()=>{S("进行多版本修改"),setTimeout(()=>{let e=document.querySelector('button[type="submit"]');e&&e.click()},100)},children:"多版本修改"})]})]}):(0,n.jsxs)(n.Fragment,{children:[G.map(e=>(0,n.jsxs)("div",{className:m("rounded-lg p-3 text-sm","user"===e.role?"bg-primary/10 border border-primary/20":"bg-muted/30"),children:[(0,n.jsxs)("div",{className:"mb-2 flex items-center gap-2",children:["user"===e.role?(0,n.jsx)(tc.Z,{className:"h-4 w-4 text-primary"}):(0,n.jsx)(tm.Z,{className:"h-4 w-4 text-primary"}),(0,n.jsx)("span",{className:"font-medium text-foreground text-xs",children:"user"===e.role?"用户":"智能开发助手"}),(0,n.jsx)("span",{className:"ml-auto text-[10px] text-muted-foreground",children:e.timestamp})]}),"assistant"===e.role&&e.thinking&&(0,n.jsxs)("div",{className:"mb-3",children:[(0,n.jsxs)("button",{type:"button",onClick:()=>ed(e.id),className:"flex items-center gap-1.5 text-xs text-muted-foreground hover:text-foreground mb-2",children:[(0,n.jsx)(tl.Z,{className:"h-3 w-3"}),(0,n.jsx)("span",{children:"思考过程"}),e.isThinkingExpanded?(0,n.jsx)(J.Z,{className:"h-3 w-3"}):(0,n.jsx)(H.Z,{className:"h-3 w-3"})]}),e.isThinkingExpanded&&(0,n.jsx)("div",{className:"rounded-md bg-muted/50 p-2.5 text-xs text-muted-foreground whitespace-pre-wrap border-l-2 border-cyan-500/50",children:e.thinking})]}),(0,n.jsxs)("div",{className:"text-foreground leading-relaxed whitespace-pre-wrap",children:[e.content,e.hitlData&&(0,n.jsx)(tA,{data:e.hitlData,onSelect:(t,s)=>ee(e.id,t,s)})]}),e.generatedFiles&&e.generatedFiles.length>0&&(0,n.jsx)("div",{className:"mt-3 rounded-lg border border-border bg-card p-3",children:(0,n.jsx)("div",{className:"space-y-1",children:e.generatedFiles.map((e,t)=>{let s=null==h?void 0:h.find(t=>t.name===e.name.split(".")[0]&&t.path===e.path);return(0,n.jsx)("div",{className:m("flex items-center gap-2 text-xs","folder"===e.type?"":"ml-4",s&&"cursor-pointer hover:bg-ide-hover rounded px-1 transition-colors"),onClick:()=>s&&(null==g?void 0:g(s.id)),children:"folder"===e.type?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(H.Z,{className:"h-3 w-3 text-muted-foreground"}),(0,n.jsx)(tu.Z,{className:"h-3.5 w-3.5 text-amber-500"}),(0,n.jsx)("span",{className:"text-foreground",children:e.name})]}):"sql"===e.type||"table"===e.type?(0,n.jsxs)(n.Fragment,{children:["table"===e.type?(0,n.jsxs)("div",{className:"relative",children:[(0,n.jsx)(U.Z,{className:"h-3.5 w-3.5 text-blue-500"}),e.dependencyOrder&&(0,n.jsx)("div",{className:"absolute -top-1 -right-1 flex h-3 w-3 items-center justify-center rounded-full bg-blue-600 text-[8px] text-white ring-1 ring-card",children:e.dependencyOrder})]}):(0,n.jsx)(M.Z,{className:"h-3.5 w-3.5 text-cyan-500"}),(0,n.jsx)("span",{className:"text-foreground",children:e.name}),e.changes&&(0,n.jsxs)("span",{className:"ml-2",children:[(0,n.jsxs)("span",{className:"text-green-400",children:["+",e.changes.added]})," ",(0,n.jsxs)("span",{className:"text-red-400",children:["-",e.changes.removed]})]})]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"relative",children:[(0,n.jsx)(L.Z,{className:"h-3.5 w-3.5 text-orange-500"}),e.dependencyOrder&&(0,n.jsx)("div",{className:"absolute -top-1 -right-1 flex h-3 w-3 items-center justify-center rounded-full bg-orange-600 text-[8px] text-white ring-1 ring-card",children:e.dependencyOrder})]}),(0,n.jsx)("span",{className:"text-foreground",children:e.name})]})},t)})})}),"assistant"===e.role&&(0,n.jsxs)("div",{className:"mt-3 flex items-center gap-1 pt-2 border-t border-border/50",children:[(0,n.jsx)(v,{variant:"ghost",size:"sm",className:"h-6 px-2 text-muted-foreground hover:text-foreground",children:(0,n.jsx)(tx.Z,{className:"h-3 w-3"})}),(0,n.jsx)(v,{variant:"ghost",size:"sm",className:"h-6 px-2 text-muted-foreground hover:text-foreground",children:(0,n.jsx)(tp.Z,{className:"h-3 w-3"})}),(0,n.jsx)(v,{variant:"ghost",size:"sm",className:"h-6 px-2 text-muted-foreground hover:text-foreground",children:(0,n.jsx)(th.Z,{className:"h-3 w-3"})}),(0,n.jsx)(v,{variant:"ghost",size:"sm",className:"h-6 px-2 text-muted-foreground hover:text-foreground",children:(0,n.jsx)(tg.Z,{className:"h-3 w-3"})})]})]},e.id)),$&&(0,n.jsxs)("div",{className:"rounded-lg p-3 text-sm bg-muted/30",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)(tm.Z,{className:"h-4 w-4 text-primary"}),(0,n.jsx)("span",{className:"font-medium text-foreground text-xs",children:"智能开发助手"}),(0,n.jsxs)("div",{className:"ml-2 flex gap-1",children:[(0,n.jsx)("span",{className:"w-1.5 h-1.5 bg-primary rounded-full animate-bounce",style:{animationDelay:"0ms"}}),(0,n.jsx)("span",{className:"w-1.5 h-1.5 bg-primary rounded-full animate-bounce",style:{animationDelay:"150ms"}}),(0,n.jsx)("span",{className:"w-1.5 h-1.5 bg-primary rounded-full animate-bounce",style:{animationDelay:"300ms"}})]})]}),(0,n.jsx)("div",{className:"mt-2 text-xs text-muted-foreground",children:"正在思考..."})]})]})}):(0,n.jsxs)("div",{className:"p-3 space-y-4",children:[null==es?void 0:es.messages.map(e=>(0,n.jsxs)("div",{className:m("rounded-lg p-3 text-sm","user"===e.role?"bg-primary/10 border border-primary/20":"bg-muted/30"),children:[(0,n.jsxs)("div",{className:"mb-2 flex items-center gap-2",children:["user"===e.role?(0,n.jsx)(tc.Z,{className:"h-4 w-4 text-primary"}):(0,n.jsx)(tm.Z,{className:"h-4 w-4 text-primary"}),(0,n.jsx)("span",{className:"font-medium text-foreground text-xs",children:"user"===e.role?"用户":"智能开发助手"}),(0,n.jsx)("span",{className:"ml-auto text-[10px] text-muted-foreground",children:e.timestamp})]}),(0,n.jsx)("div",{className:"text-foreground leading-relaxed whitespace-pre-wrap",children:e.content}),"assistant"===e.role&&(0,n.jsxs)("div",{className:"mt-3 flex items-center gap-1 pt-2 border-t border-border/50",children:[(0,n.jsx)(v,{variant:"ghost",size:"sm",className:"h-6 px-2 text-muted-foreground hover:text-foreground",children:(0,n.jsx)(tx.Z,{className:"h-3 w-3"})}),(0,n.jsx)(v,{variant:"ghost",size:"sm",className:"h-6 px-2 text-muted-foreground hover:text-foreground",children:(0,n.jsx)(tp.Z,{className:"h-3 w-3"})}),(0,n.jsx)(v,{variant:"ghost",size:"sm",className:"h-6 px-2 text-muted-foreground hover:text-foreground",children:(0,n.jsx)(th.Z,{className:"h-3 w-3"})}),(0,n.jsx)(v,{variant:"ghost",size:"sm",className:"h-6 px-2 text-muted-foreground hover:text-foreground",children:(0,n.jsx)(tg.Z,{className:"h-3 w-3"})})]})]},e.id)),h.length>0&&(()=>{let e={},t=[];return[...h].sort((e,t)=>(e.dependencyOrder||999)-(t.dependencyOrder||999)).forEach(s=>{s.groupName?(e[s.groupName]||(e[s.groupName]=[]),e[s.groupName].push(s)):t.push(s)}),(0,n.jsx)("div",{className:"rounded-lg border border-border bg-card overflow-hidden",children:(0,n.jsxs)(w,{open:B,onOpenChange:W,children:[(0,n.jsxs)(A,{className:"flex w-full items-center justify-between px-3 py-2.5 hover:bg-ide-hover transition-colors",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)(tu.Z,{className:"h-4 w-4 text-muted-foreground"}),(0,n.jsx)("span",{className:"text-sm font-medium text-foreground",children:"产物汇总"})]}),B?(0,n.jsx)(J.Z,{className:"h-4 w-4 text-muted-foreground"}):(0,n.jsx)(H.Z,{className:"h-4 w-4 text-muted-foreground"})]}),(0,n.jsx)(k,{children:(0,n.jsxs)("div",{className:"border-t border-border",children:[Object.entries(e).map(e=>{let[t,s]=e;return(0,n.jsxs)("div",{className:"border-b border-border/50 last:border-0",children:[(0,n.jsx)("div",{className:"px-3 py-2 text-xs font-medium text-muted-foreground bg-muted/20",children:t}),s.map(e=>{var t;let r=ty[e.type]||R.Z,a=t_[e.type]||"text-muted-foreground",i=e.versions.find(t=>t.version===e.currentVersion)||e.versions[0],d=tN[i.status],l=e.dependencyOrder&&e.dependencyOrder>1&&(null===(t=s.find(t=>t.dependencyOrder===e.dependencyOrder-1))||void 0===t?void 0:t.versions[0].status)!=="approved";return(0,n.jsxs)("div",{className:m("px-3 py-3 hover:bg-ide-hover transition-colors cursor-pointer",l&&"opacity-60 grayscale"),onClick:()=>null==g?void 0:g(e.id),children:[(0,n.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[e.dependencyOrder&&(0,n.jsx)("span",{className:"flex h-4 w-4 shrink-0 items-center justify-center rounded-full bg-muted text-[10px] font-medium text-muted-foreground",children:e.dependencyOrder}),(0,n.jsx)(r,{className:m("h-4 w-4 shrink-0",a)}),(0,n.jsx)("span",{className:"flex-1 text-sm text-foreground truncate",children:e.name}),l?(0,n.jsxs)(el,{variant:"outline",className:"text-[10px] h-5 shrink-0 border-dashed text-muted-foreground gap-1",children:[(0,n.jsx)(ej.Z,{className:"h-3 w-3"}),"等待依赖"]}):(0,n.jsx)(el,{className:m("text-[10px] h-5 shrink-0",null==d?void 0:d.className),children:"pending_review"===i.status?"待发布":null==d?void 0:d.label})]}),(0,n.jsxs)("div",{className:"ml-8 space-y-1.5",children:[e.versions[0].changes&&(0,n.jsxs)("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[(0,n.jsx)(O.Z,{className:"h-3 w-3"}),(0,n.jsx)("span",{children:"代码变更"}),(0,n.jsxs)("span",{className:"text-green-400",children:["+",e.versions[0].changes.added]}),(0,n.jsxs)("span",{className:"text-red-400",children:["-",e.versions[0].changes.removed]})]}),"config"===e.type&&l&&(0,n.jsxs)("div",{className:"flex items-center gap-2 text-xs text-orange-500/80",children:[(0,n.jsx)(ti.Z,{className:"h-3 w-3"}),(0,n.jsx)("span",{children:"需先完成前置产物评审"})]})]})]},e.id)})]},t)}),t.map((e,s)=>{let r=ty[e.type]||R.Z,a=t_[e.type]||"text-muted-foreground",i=e.versions.find(t=>t.version===e.currentVersion)||e.versions[0],d=tN[i.status];return(0,n.jsxs)("div",{className:m("px-3 py-3 hover:bg-ide-hover transition-colors cursor-pointer",s<t.length-1&&"border-b border-border"),onClick:()=>null==g?void 0:g(e.id),children:[(0,n.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,n.jsx)(r,{className:m("h-4 w-4 shrink-0",a)}),(0,n.jsx)("span",{className:"flex-1 text-sm text-foreground truncate",children:e.name}),(0,n.jsx)(el,{className:m("text-[10px] h-5 shrink-0",null==d?void 0:d.className),children:"pending_review"===i.status?"待发布":null==d?void 0:d.label})]}),e.versions[0].changes&&(0,n.jsxs)("div",{className:"ml-6 flex items-center gap-2 text-xs text-muted-foreground",children:[(0,n.jsx)(O.Z,{className:"h-3 w-3"}),(0,n.jsx)("span",{children:"代码变更"}),(0,n.jsxs)("span",{className:"text-green-400",children:["+",e.versions[0].changes.added]}),(0,n.jsxs)("span",{className:"text-red-400",children:["-",e.versions[0].changes.removed]})]})]},e.id)})]})})]})})})(),h.some(e=>"report"===e.type)&&(0,n.jsxs)(w,{open:F,onOpenChange:q,children:[(0,n.jsxs)(A,{className:"flex w-full items-center justify-between rounded-lg border border-border bg-card px-3 py-2.5 hover:bg-ide-hover transition-colors",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)(tf.Z,{className:"h-4 w-4 text-muted-foreground"}),(0,n.jsxs)("span",{className:"text-sm text-foreground",children:[h.filter(e=>"report"===e.type).length," 个探查报告"]})]}),F?(0,n.jsx)(J.Z,{className:"h-4 w-4 text-muted-foreground"}):(0,n.jsx)(H.Z,{className:"h-4 w-4 text-muted-foreground"})]}),(0,n.jsx)(k,{className:"mt-2"})]}),es&&(0,n.jsxs)("div",{className:"flex items-center gap-3 py-2 text-xs text-muted-foreground",children:[(0,n.jsxs)("div",{className:"flex items-center gap-1",children:[(0,n.jsx)(ta.Z,{className:"h-3.5 w-3.5 text-green-400"}),(0,n.jsx)("span",{children:"已完成"})]}),(0,n.jsxs)("div",{className:"flex items-center gap-1",children:[(0,n.jsx)(R.Z,{className:"h-3.5 w-3.5"}),(0,n.jsx)("span",{children:"全部文件"})]}),(0,n.jsxs)("div",{className:"flex items-center gap-1 ml-auto",children:[(0,n.jsx)(v,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0",children:(0,n.jsx)(tx.Z,{className:"h-3 w-3"})}),(0,n.jsx)(v,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0",children:(0,n.jsx)(tp.Z,{className:"h-3 w-3"})}),(0,n.jsx)(v,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0",children:(0,n.jsx)(tg.Z,{className:"h-3 w-3"})}),(0,n.jsx)(v,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0",children:(0,n.jsx)(th.Z,{className:"h-3 w-3"})})]})]}),!es&&(0,n.jsx)("div",{className:"py-8 text-center text-sm text-muted-foreground",children:"请选择一个会话"})]}),(0,n.jsx)("div",{ref:X})]}),p.total>0&&!I&&(0,n.jsx)("div",{className:"shrink-0 border-t border-border bg-muted/30 px-3 py-2",children:(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2 text-xs",children:[(0,n.jsx)(eE.Z,{className:"h-4 w-4 text-primary"}),(0,n.jsxs)("span",{className:"text-foreground font-medium",children:[p.total," 个变更待评审"]}),(0,n.jsx)(J.Z,{className:"h-3.5 w-3.5 text-muted-foreground"})]}),(0,n.jsx)(v,{size:"sm",className:"h-7 px-3 text-xs bg-primary text-white hover:bg-primary/90",onClick:c,children:"去评审"})]})}),(0,n.jsxs)("div",{className:"shrink-0 border-t border-border bg-ide-panel-header p-3",children:[(0,n.jsxs)("div",{className:"relative mb-2",children:[(0,n.jsx)(b,{value:E,onChange:e=>S(e.target.value),placeholder:"输入你的需求，@ 添加资源",className:"pr-10 h-10 text-sm border-border bg-input text-foreground placeholder:text-muted-foreground",onKeyDown:e=>{"Enter"===e.key&&E.trim()&&ea()}}),(0,n.jsx)(v,{size:"icon",className:"absolute right-1 top-1/2 -translate-y-1/2 h-8 w-8 rounded-full bg-primary hover:bg-primary/90 disabled:opacity-50",disabled:!E.trim(),onClick:ea,children:(0,n.jsx)(tv.Z,{className:"h-4 w-4"})})]}),(0,n.jsxs)("div",{className:"flex items-center gap-1 text-xs",children:[(0,n.jsxs)(v,{variant:"ghost",size:"sm",className:m("h-7 px-2.5 gap-1",V?"text-muted-foreground hover:text-foreground":"text-primary bg-primary/10"),onClick:()=>P(!1),children:[(0,n.jsx)(O.Z,{className:"h-3.5 w-3.5"}),"开发"]}),(0,n.jsxs)(v,{variant:"ghost",size:"sm",className:m("h-7 px-2.5 gap-1",V?"text-cyan-400 bg-cyan-500/10":"text-muted-foreground hover:text-foreground"),onClick:()=>P(!0),children:[(0,n.jsx)(tl.Z,{className:"h-3.5 w-3.5"}),"Plan 模式"]}),(0,n.jsx)(v,{variant:"ghost",size:"sm",className:"h-7 px-2.5 text-muted-foreground hover:text-foreground",children:"拓展 8"}),(0,n.jsx)("span",{className:"flex-1"}),(0,n.jsxs)(tt,{children:[(0,n.jsx)(ts,{asChild:!0,children:(0,n.jsxs)(v,{variant:"ghost",size:"sm",className:"h-7 px-2.5 gap-1 text-muted-foreground hover:text-foreground",children:["Gemini-3-Pro",(0,n.jsx)(H.Z,{className:"h-3 w-3"})]})}),(0,n.jsxs)(tn,{align:"end",className:"w-40 bg-popover",children:[(0,n.jsx)(tr,{children:"Gemini-3-Pro"}),(0,n.jsx)(tr,{children:"Gemini-3-Flash"}),(0,n.jsx)(tr,{children:"Claude-3.5"})]})]}),(0,n.jsx)(v,{variant:"ghost",size:"icon",className:"h-7 w-7 text-muted-foreground",children:(0,n.jsx)(eE.Z,{className:"h-3.5 w-3.5"})}),(0,n.jsx)(v,{variant:"ghost",size:"icon",className:"h-7 w-7 text-muted-foreground",children:(0,n.jsx)(tb.Z,{className:"h-3.5 w-3.5"})}),(0,n.jsx)(v,{variant:"ghost",size:"icon",className:"h-7 w-7 text-muted-foreground",children:(0,n.jsx)(to.Z,{className:"h-3.5 w-3.5"})})]})]}),(0,n.jsx)(eu,{open:y,onOpenChange:_,children:(0,n.jsxs)(eh,{className:"bg-card",children:[(0,n.jsxs)(eg,{children:[(0,n.jsx)(ev,{className:"text-foreground",children:"确认回滚"}),(0,n.jsxs)(eb,{children:["您确定要将 ",(0,n.jsx)("strong",{children:null==a?void 0:a.name})," 回滚到版本 ",(0,n.jsx)("strong",{children:null==T?void 0:T.version})," 吗？"]})]}),er&&(null==en?void 0:en.rollbackCapability)==="limited"&&(0,n.jsxs)("div",{className:m("flex items-start gap-2 rounded-lg p-3 text-xs",er.badgeClass),children:[(0,n.jsx)(ti.Z,{className:"mt-0.5 h-4 w-4 shrink-0"}),(0,n.jsxs)("div",{children:[(0,n.jsxs)("p",{className:"font-medium",children:["注意：",en.label,"为",er.label,"产物"]}),(0,n.jsx)("p",{className:"mt-1 text-muted-foreground",children:en.rollbackDescription})]})]}),(0,n.jsxs)(ef,{children:[(0,n.jsx)(v,{variant:"outline",onClick:()=>_(!1),className:"bg-transparent text-foreground hover:bg-ide-hover",children:"取消"}),(0,n.jsx)(v,{onClick:()=>{_(!1),C(null)},children:"确认回滚"})]})]})})]})}function tT(){var e;let[t,s]=(0,r.useState)((null===(e=eI[0])||void 0===e?void 0:e.id)||""),[d,l]=(0,r.useState)("all"),[o,c]=(0,r.useState)(null),[m,h]=(0,r.useState)(null),[g,f]=(0,r.useState)(eD),[b,j]=(0,r.useState)(eI),N=(0,r.useCallback)(()=>{i.Am.info("正在返回数据开发平台...",{description:"已保存所有产物状态",duration:2e3})},[]),y=b.find(e=>e.id===t),_=(0,r.useMemo)(()=>{var e;return e=function(e,t,s){let n=(s||eI).find(t=>t.id===e);return n?t.filter(e=>n.artifactIds.includes(e.id)):[]}(t,g,b),"all"===d?e:e.filter(e=>e.type===d)},[t,g,d,b]),w=(0,r.useMemo)(()=>o?_.find(e=>e.id===o)||null:_[0]||null,[_,o]),A=(0,r.useCallback)(e=>{s(e),c(null),h(null),l("all")},[]),k=(0,r.useCallback)(e=>{c(e),h(null)},[]),T=(0,r.useCallback)(e=>{h(e)},[]),C=(0,r.useCallback)((e,t,s,n)=>{f(n=>n.map(n=>n.id!==e?n:{...n,versions:n.versions.map(e=>e.id!==t?e:{...e,status:s})})),h(e=>(null==e?void 0:e.id)===t?{...e,status:s}:e)},[]),E=(0,r.useMemo)(()=>_.filter(e=>e.versions.some(e=>e.sessionId===t&&"pending_review"===e.status)),[_,t]),S=(0,r.useCallback)(()=>{let e;if(0===E.length)return;let t=E.findIndex(e=>e.id===o);if(-1===t)e=E[0];else{let s=(t+1)%E.length;e=E[s]}e&&(c(e.id),h(null))},[E,o]),I=(0,r.useMemo)(()=>E.length>1||1===E.length&&E[0].id!==o,[E,o]),D=(0,r.useCallback)(e=>{let t="session-".concat(Date.now()),n=new Date().toISOString().slice(0,19).replace("T"," "),r={id:t,title:e.title,createdAt:n,updatedAt:n,changeType:"create",scenario:e.isPlanMode?"Plan模式 - 计划驱动开发":"直接开发模式",phase:e.isPlanMode?"planning":"developing",messages:[{id:"msg-".concat(Date.now()),role:"user",content:e.message,timestamp:n}],artifactIds:[]};e.isPlanMode&&(r.planArtifactId="artifact-plan-".concat(Date.now())),j(e=>[r,...e]),s(t),c(null),h(null),l("all"),console.log("[v0] Created new session:",r)},[]),O=(0,r.useCallback)(e=>{let t=new Date().toISOString().slice(0,19).replace("T"," "),n=[],r=[],a=[],i=b.some(t=>t.id===e.sessionId);if(!i){let n={id:e.sessionId,title:e.sessionTitle,createdAt:t,updatedAt:t,changeType:"create",scenario:"直接开发模式",phase:"dev_review",messages:e.history?e.history.map((e,s)=>({id:"msg-".concat(Date.now(),"-").concat(s),role:e.role,content:e.content,timestamp:t})):[{id:"msg-".concat(Date.now()),role:"assistant",content:"已为您生成 ".concat(e.files.length," 个文件，请查看。"),timestamp:t}],artifactIds:[]};j(e=>[n,...e]),s(e.sessionId),i=!0}e.files.forEach((s,i)=>{let d,l;if("folder"===s.type)return;let o="artifact-".concat(Date.now(),"-").concat(i),c=!!(e.isEdit||s.isEdit),m=e=>e?"---\ndescription: 用户订单统计 - 日维度聚合（含退款指标）\nqueue: cn/lf/default/root.default_dorado_public\npriority: high # high (原 normal)\n\nfrequency: daily\ncronExpression: 0 3 * * * # 03:00 (原 02:00)\n\ndependencies:\n  - branchIds: null\n    dependNonExistParents: false\n    offsetFrequency: daily\n    offsets:\n      - 0\n    offsetsType: set\n    parentTaskId: 123652997\n---":"---\ndescription: 同步线上 ".concat(s.name.split(".")[0]," 数据到 测试库\nqueue: cn/lf/default/root.default_dorado_public\npriority: normal # normal/high/super_high/core_task/super_core_task\n\nfrequency: daily\ncronExpression: 0 0 * * *\n\ndependencies:\n  - branchIds: null\n    dependNonExistParents: false\n    offsetFrequency: daily\n    offsets:\n      - 0\n    offsetsType: set\n    parentTaskId: 123652997\n---");"sql"===s.type||"task"===s.type?(d=c?"-- ***************************************************************\n-- Author: AI Assistant\n-- CreateTime: 2025-12-01 10:00:00\n-- UpdateTime: ".concat(t,"\n-- Description: 用户订单统计 - 日维度聚合（含退款指标）\n-- ***************************************************************\n\nINSERT OVERWRITE TABLE dm.").concat(s.name.split(".")[0],"\n  PARTITION(dt='${date}')\nSELECT\n    user_id,\n    COUNT(order_id) AS order_count,\n    SUM(order_amount) AS total_amount,\n    -- 优化：排除退款订单计算平均金额\n    SUM(CASE WHEN refund_status = 'none' THEN order_amount ELSE 0 END) /\n      NULLIF(SUM(CASE WHEN refund_status = 'none' THEN 1 ELSE 0 END), 0) AS avg_order_amount,\n    -- 新增：退款订单数\n    SUM(CASE WHEN refund_status = 'refunded' THEN 1 ELSE 0 END) AS refund_count,\n    -- 新增：退款金额\n    SUM(CASE WHEN refund_status = 'refunded' THEN order_amount ELSE 0 END) AS refund_amount,\n    MIN(order_time) AS first_order_time,\n    MAX(order_time) AS last_order_time\nFROM\n    dwd.dwd_order_df\nWHERE\n    dt = '${date}'\n    AND order_status IN ('completed', 'refunded')\nGROUP BY\n    user_id;"):"-- ************************************************************************************\n-- 基于AI引擎自动生成\n-- Author: AI Assistant\n-- CreateTime: ".concat(t,"\n-- Description: ").concat(s.name.split(".")[0],"\n-- ************************************************************************************\n\nINSERT OVERWRITE TABLE copilot_demo.").concat(s.name.split(".")[0],"\nPARTITION(dt='${date}')\nSELECT\n    shop_id,\n    metric_name,\n    metric_value,\n    SUM(exposure_cnt) AS total_exposure,\n    COUNT(*) AS record_count\nFROM copilot_demo.dwd_shop_metric_detail_df\nWHERE dt = '${date}'\nGROUP BY shop_id, metric_name, metric_value\nORDER BY total_exposure DESC;"),c&&(l="-- ***************************************************************\n-- Author: AI Assistant\n-- CreateTime: 2025-12-01 10:00:00\n-- Description: 用户订单统计 - 日维度聚合\n-- ***************************************************************\n\nINSERT OVERWRITE TABLE dm.".concat(s.name.split(".")[0],"\n  PARTITION(dt='${date}')\nSELECT\n    user_id,\n    COUNT(order_id) AS order_count,\n    SUM(order_amount) AS total_amount,\n    SUM(order_amount) / COUNT(order_id) AS avg_order_amount,\n    MIN(order_time) AS first_order_time,\n    MAX(order_time) AS last_order_time\nFROM\n    dwd.dwd_order_df\nWHERE\n    dt = '${date}'\n    AND order_status = 'completed'\nGROUP BY\n    user_id;"))):"config"===s.type?(d=m(c),c&&(l="---\ndescription: 用户订单统计 - 日维度聚合\nqueue: cn/lf/default/root.default_dorado_public\npriority: normal\n\nfrequency: daily\ncronExpression: 0 2 * * *\n\ndependencies:\n  - branchIds: null\n    dependNonExistParents: false\n    offsetFrequency: daily\n    offsets:\n      - 0\n    offsetsType: set\n    parentTaskId: 123652997\n---")):"table"===s.type?d="-- ************************************************************************************\n-- 基于AI引擎自动生成\n-- Author: AI Assistant\n-- CreateTime: ".concat(t,"\n-- Description: ").concat(s.name.split(".")[0],"\n-- ************************************************************************************\n\nCREATE TABLE IF NOT EXISTS copilot_demo.").concat(s.name.split(".")[0],"\nPARTITION(dt='${date}')\n(\n    shop_id String COMMENT '店铺ID',\n    metric_name String COMMENT '指标名称',\n    metric_value Float64 COMMENT '指标值',\n    total_exposure Int64 COMMENT '总曝光',\n    record_count Int64 COMMENT '记录数',\n    dt String COMMENT '日期分区'\n)\nENGINE = MergeTree()\nPARTITION BY toYYYYMMDD(toDate(dt))\nORDER BY (shop_id, metric_name)\nSETTINGS index_granularity = 8192;"):"plan"===s.type?d="# 实施计划: ".concat(s.name.replace(".md",""),'\n\n## 1. 概述\n本计划旨在开发 HiveSQL 任务 "').concat(s.name.replace("implementation_plan.md","dm_gvn_shop_exp_metric_extend_df"),'"。\n\n## 2. 技术方案\n\n### 2.1 数据流向\n- **输入**: `dwd.dwd_order_df`\n- **输出**: `dm.dm_gvn_shop_exp_metric_extend_df`\n\n### 2.2 表结构设计\n| 字段名 | 类型 | 描述 |\n|---|---|---|\n| shop_id | string | 店铺 ID |\n| exp_metric | decimal | 曝光指标 |\n| dt | string | 日期分区 |\n\n### 3. 执行步骤\n1. 创建表结构 (DDL)\n2. 开发 SQL 转换逻辑\n3. 配置调度任务及依赖\n4. 部署上线并验证数据\n\n## 4. 风险评估与应对\n- **数据倾斜**: 增加倾斜处理逻辑。\n- **依赖延迟**: 配置 SLA 告警。\n\n*由 AI 助手于 ').concat(t," 生成*"):(d=m(c),c&&(l="---\ndescription: 用户订单统计 - 日维度聚合\nqueue: cn/lf/default/root.default_dorado_public\npriority: normal\n\nfrequency: daily\ncronExpression: 0 2 * * *\n\ndependencies:\n  - branchIds: null\n    dependNonExistParents: false\n    offsetFrequency: daily\n    offsets:\n      - 0\n    offsetsType: set\n    parentTaskId: 123652997\n---"));let u={id:o,name:s.name.split(".")[0],type:"sql"===s.type?"task":s.type,path:s.path,currentVersion:e.isMultiVersion?"v5":c?"v2":"v1",createdAt:c||e.isMultiVersion?"2025-12-01 10:00:00":t,updatedAt:t,owner:"AI Assistant",changeType:c||e.isMultiVersion?"modify":"create",groupId:e.groupId,groupName:e.groupName,dependencyOrder:s.dependencyOrder,versions:e.isMultiVersion?[{id:"v1-".concat(o),version:"v1",status:"deployed",createdAt:"2025-10-01 10:00:00",createdBy:"shenyulin.sanshui",changeDescription:"初始版本",yamlContent:l||"",sessionId:"session-old-1"},{id:"v2-".concat(o),version:"v2",status:"deployed",createdAt:"2025-10-15 14:30:00",createdBy:"zhangsan.dev",changeDescription:"Fix: calculation logic",yamlContent:l||"",sessionId:"session-old-2"},{id:"v3-".concat(o),version:"v3",status:"deployed",createdAt:"2025-11-01 09:15:00",createdBy:"lisi.qa",changeDescription:"Add: new metrics",yamlContent:l||"",sessionId:"session-old-3"},{id:"v4-".concat(o),version:"v4",status:"deployed",createdAt:"2025-12-01 10:00:00",createdBy:"wangwu.pm",changeDescription:"Update: dependency",yamlContent:l||"",sessionId:"session-old-4"},{id:"v5-".concat(o),version:"v5",status:"pending_review",createdAt:t,createdBy:"AI Assistant",changeDescription:"Optimized query plan and refactored logic (V5)",yamlContent:d,previousContent:l,sessionId:e.sessionId,changes:s.changes}]:c?[{id:"v1-".concat(o),version:"v1",status:"deployed",createdAt:"2025-12-01 10:00:00",createdBy:"shenyulin.sanshui",changeDescription:"初始版本",yamlContent:l||"",sessionId:"session-old-1"},{id:"v2-".concat(o),version:"v2",status:"pending_review",createdAt:t,createdBy:"AI Assistant",changeDescription:c?"新增退款指标，优化均价计算逻辑":"Initial generation by AI",yamlContent:d,previousContent:l,sessionId:e.sessionId}]:[{id:"v1-".concat(o),version:"v1",status:"plan"===s.type?"approved":"pending_review",createdAt:t,createdBy:"AI Assistant",changeDescription:"plan"===s.type?"开发计划已生成":"Initial generation by AI",yamlContent:d,sessionId:e.sessionId,changes:s.changes}]};"config"===s.type&&a.length>0&&s.dependencyOrder&&s.dependencyOrder>1&&(u.dependencies=[...a]),"table"===s.type&&a.push(o),n.push(u),r.push(o)}),f(e=>[...e,...n]),j(t=>t.map(t=>t.id===e.sessionId?{...t,artifactIds:[...t.artifactIds,...r]}:t)),r.length>0&&c(r[0]),console.log("[v0] Generated artifacts:",n)},[b]),M=(0,r.useCallback)(e=>{f(s=>s.map(s=>{if(s.type!==e)return s;let n=b.find(e=>e.id===t);return(null==n?void 0:n.artifactIds.includes(s.id))?{...s,versions:s.versions.map(e=>e.sessionId!==t||"pending_review"!==e.status?e:{...e,status:"approved"})}:s}))},[t,b]),L=(0,r.useCallback)(()=>{f(e=>e.map(e=>{let s=b.find(e=>e.id===t);return(null==s?void 0:s.artifactIds.includes(e.id))?{...e,versions:e.versions.map(e=>e.sessionId!==t||"pending_review"!==e.status?e:{...e,status:"approved"})}:e}))},[t,b]),R=(0,r.useCallback)(e=>{i.Am.success("计划已采纳，正在生成代码..."),f(t=>t.map(t=>t.id===e?{...t,versions:t.versions.map(e=>e.version===t.currentVersion?{...e,status:"approved"}:e)}:t));let s="dm_gvn_shop_exp_metric_extend_df",n=g.find(t=>t.id===e),r=(null==n?void 0:n.groupId)||"group-hive-".concat(Date.now());setTimeout(()=>{t&&(O({sessionId:t,sessionTitle:"HiveSQL 任务开发",files:[{type:"task",name:"".concat(s,".sql"),path:"LeapAgentDemos/new_session/".concat(s,".sql"),changes:{added:25,removed:6}},{type:"config",name:"".concat(s,".config"),path:"LeapAgentDemos/new_session/".concat(s,".config")}],groupId:r,groupName:"HiveSQL 任务-".concat(s)}),i.Am.success("已生成开发产物"))},1500)},[g,t,O]),z=(0,r.useMemo)(()=>{let e={total:0,plan:0,task:0,table:0,config:0,report:0};return _.forEach(s=>{s.versions.some(e=>e.sessionId===t&&"pending_review"===e.status)&&(e.total++,e[s.type]++)}),e},[_,t]),Z=(0,r.useCallback)(e=>{if(!w)return;let s=new Date().toLocaleString("zh-CN",{hour12:!1}),n="v".concat(w.versions.length+1),r={id:"".concat(n,"-").concat(w.id),version:n,status:"pending_review",createdAt:s,createdBy:"用户 (回滚)",changeDescription:"回滚至版本 ".concat(e.version),yamlContent:e.yamlContent,previousContent:w.versions[w.versions.length-1].yamlContent||"",sessionId:t,changes:{added:0,removed:0}};f(e=>e.map(e=>e.id===w.id?{...e,currentVersion:r.version,versions:[...e.versions,r]}:e)),h(r),i.Am.success("已回滚至版本 ".concat(e.version,"，生成新版本 ").concat(r.version))},[w,t]);return(0,n.jsxs)("div",{className:"flex h-screen flex-col bg-background text-foreground font-sans dark",children:[(0,n.jsxs)("header",{className:"flex h-12 shrink-0 items-center justify-between border-b border-border bg-ide-header px-4",children:[(0,n.jsxs)("div",{className:"flex items-center gap-3",children:[(0,n.jsx)(v,{variant:"ghost",size:"icon",className:"h-8 w-8 text-muted-foreground hover:text-foreground",onClick:N,children:(0,n.jsx)(a.Z,{className:"h-4 w-4"})}),(0,n.jsx)("div",{className:"h-4 w-px bg-border"}),(0,n.jsx)("span",{className:"text-sm font-semibold text-foreground",children:"产物中心"}),(0,n.jsx)("span",{className:"text-xs text-muted-foreground",children:"Artifact Center"})]}),(0,n.jsxs)("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[(0,n.jsxs)("span",{children:["当前会话: ",null==y?void 0:y.title]}),(0,n.jsx)("span",{className:"text-border",children:"|"}),(0,n.jsxs)("span",{children:[_.length," 个产物"]}),z.total>0&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("span",{className:"text-border",children:"|"}),(0,n.jsxs)("span",{className:"text-amber-400",children:[z.total," 待审核"]})]})]})]}),(0,n.jsx)("main",{className:"flex-1 overflow-hidden",children:(0,n.jsxs)(u,{direction:"horizontal",className:"h-full",children:[(0,n.jsx)(x,{defaultSize:20,minSize:15,maxSize:30,children:(0,n.jsx)(q,{artifacts:_,selectedArtifactId:(null==w?void 0:w.id)||null,onSelectArtifact:k,filterType:d,onFilterChange:l,currentSession:y})}),(0,n.jsx)(p,{}),(0,n.jsx)(x,{defaultSize:55,minSize:30,children:(0,n.jsx)(e7,{artifact:w,onVersionSelect:T,selectedVersion:m,onStatusChange:C,currentSessionId:t,onNextPendingArtifact:S,hasNextPendingArtifact:I,sessionArtifacts:_,onPlanApproved:R,onRevert:Z})}),(0,n.jsx)(p,{}),(0,n.jsx)(x,{defaultSize:25,minSize:20,maxSize:35,children:(0,n.jsx)(tk,{sessions:b,currentSessionId:t,artifact:w,selectedVersion:m,onVersionSelect:T,onSessionChange:A,onBatchApproveByType:M,onBatchApproveAll:L,onNewSession:D,onArtifactsGenerated:O,pendingStats:z,sessionArtifacts:_,onSelectArtifact:k})})]})})]})}}},function(e){e.O(0,[54,971,117,744],function(){return e(e.s=6654)}),_N_E=e.O()}]);